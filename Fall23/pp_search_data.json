[{"url":"cheatsheets/","title":"Cheatsheets","tags":["welcome"],"text":"Cheatsheets Getting Started with Julia - live . Fastrack to Julia  cheatsheet. MATLAB-Julia-Python comparative cheatsheet  by  QuantEcon group Plots.jl cheatsheet"},{"url":".","title":"Welcome","tags":["homepage"],"text":"Course Website of  Economic and Financial Network Analysis This website contains the course material of the 2022 edition of the course. The course is part of the Master in Econometrics at the University of Amsterdam. The official course information can be found on Canvas. This website is under construction. Acknowledgement \nThe design of this website is based on  Computational Thinking , a live online Julia/Pluto textbook. (computationalthinking.mit.edu) Build your own course website using https://github.com/greimel/pluto-course-template"},{"url":"installation/","title":"Software installation","tags":["welcome"],"text":"First-time setup: Install Julia & Pluto Video version: Text and pictures version: Step 1: Install Julia  1.8.2 Go to  https://julialang.org/downloads  and download the current stable release, Julia  1.8.2 , using the correct version for your operating system (Linux x86, Mac, Windows, etc). Step 2: Run Julia After installing,  make sure that you can run Julia . On some systems, this means searching for the ‚ÄúJulia  1.8.2 ‚Äù program installed on your computer; in others, it means running the command  julia  in a terminal. Make sure that you can execute  1 + 1 : Make sure that you are able to launch Julia and calculate  1+1  before proceeding! Step 3: Install  Pluto Next we will install the  Pluto , the notebook environment that we will be using during the course. Pluto is a Julia  programming environment  designed for interactivity and quick experiments. Open the  Julia REPL . This is the command-line interface to Julia, similar to the previous screenshot. Here you type  Julia commands , and when you press ENTER, it runs, and you see the result. To install Pluto, we want to run a  package manager command . To switch from  Julia  mode to  Pkg  mode, type  ]  (closing square bracket) at the  julia>  prompt: \njulia> ]\n\n(@v 1.8 ) pkg>\n The line turns blue and the prompt changes to  pkg> , telling you that you are now in  package manager mode . This mode allows you to do operations on  packages  (also called libraries). To install Pluto, run the following (case sensitive) command to  add  (install) the package to your system by downloading it from the internet.\nYou should only need to do this  once  for each installation of Julia: \n(@v 1.8 ) pkg> add Pluto\n This might take a couple of minutes, so you can go get yourself a cup of tea! You can now close the terminal. Step 4: Use a modern browser: Mozilla Firefox or Google Chrome We need a modern browser to view Pluto notebooks with. Firefox and Chrome work best. Second time:  Running Pluto & opening a notebook Repeat the following steps whenever you want to work on a project or homework assignment. Step 1: Start Pluto Start the Julia REPL, like you did during the setup. In the REPL, type: julia> using Pluto\n\njulia> Pluto.run()\n The terminal tells us to go to  http://localhost:1234/  (or a similar URL). Let‚Äôs open Firefox or Chrome and type that into the address bar. If you‚Äôre curious about what a  Pluto notebook  looks like, have a look at the  Featured Notebooks . These notebooks are useful for learning some basics of Julia programming. If you want to hear the story behind Pluto, have a look a the  JuliaCon presentation . If nothing happens in the browser the first time, close Julia and try again. And please let us know! Step 2a: Opening a notebook from the web This is the main menu - here you can create new notebooks, or open existing ones. Our homework assignments will always be based on a  template notebook , available in this GitHub repository. To start from a template notebook on the web, you can  paste the URL into the blue box  and press ENTER. For example, homework 0 is available  here . Go to this page, and on the top right, click on the button that says ‚ÄúEdit or run this notebook‚Äù. From these instructions, copy the notebook link, and paste it into the box. Press ENTER, and select OK in the confirmation box. The first thing we will want to do is to save the notebook somewhere on our own computer; see below. Step 2b: Opening an existing notebook file When you launch Pluto for the second time, your recent notebooks will appear in the main menu. You can click on them to continue where you left off. If you want to run a local notebook file that you have not opened before, then you need to enter its  full path  into the blue box in the main menu. More on finding full paths in step 3. Step 3: Saving a notebook We first need a folder to save our homework in. Open your file explorer and create one. Next, we need to know the  absolute path  of that folder. Here‚Äôs how you do that in  Windows ,  MacOS  and  Ubuntu . For example, you might have: C:\\Users\\fons\\Documents\\18S191_assignments\\  on Windows /Users/fons/Documents/18S191_assignments/  on MacOS /home/fons/Documents/18S191_assignments/  on Ubuntu Now that we know the absolute path, go back to your Pluto notebook, and at the top of the page, click on  ‚ÄúSave notebook‚Ä¶‚Äù . This is where you type the  new path+filename for your notebook : Click  Choose . Step 4: Sharing a notebook After working on your notebook (your code is autosaved when you run it), you will find your notebook file in the folder we created in step 3. This the file that you can share with others, or submit as your homework assignment to Canvas. \nconst run = f => f();\nrun(async () => {\nconst versions = await (await fetch(`https://julialang-s3.julialang.org/bin/versions.json`)).json()\nconst version_names = Object.keys(versions).sort().reverse()\nconst stable = version_names.find(v => versions[v].stable)\nconsole.log({stable})\nconst pkg_stable = /\\d+\\.\\d+/.exec(stable)[0]\ndocument.querySelectorAll(\"auto-julia-version\").forEach(el => {\n    console.log(el)\n    el.innerText = el.getAttribute(\"short\") == null ? stable : pkg_stable\n})\n});"},{"url":"search/","title":"Search results","tags":[],"text":"window.init_search(); Search Results \nLoading..."},{"url":"sidebar data/","title":"sidebar data","tags":[],"text":"Dict main \"welcome\" collections \"welcome\" .pages, \"Julia basics\" collections \"julia basics\" .pages, \"Networks basics\" collections \"networks basics\" .pages, \"Diffusion on Networks\" collections \"diffusion\" .pages, \"Financial networks\" collections \"financial networks\" .pages, , about Dict authors name \"Fabian Greimel\", url \"https www.greimel.eu\" , name \"Simon Trimborn\", url \"https www.simontrimborn.de\" , title \"Networks in Economics and Finance\", subtitle \"Theory, Computation and Data\", term \"Spring 2024\", institution \"University of Amsterdam\", institution url \"http www.uva.nl\", institution logo \"uva logo.svg\", institution logo darkmode \"uva logo.svg\" "},{"url":"syllabus/","title":"Syllabus","tags":["welcome"],"text":"Syllabus Course Links official Canvas course page Class schedule Lecture Title Date Lecturer Notebooks Reading 1A Network Basics 1 Feb  7, 2022 Cees basic Julia ,  first networks Jackson Ch. 1 & 2 1B Network Basics 2 Feb 10, 2022 Cees coauthor network ,  power law ,  exercises Jackson Ch. 3 1C Random Networks Feb 11, 2022 Cees notebook Jackson Ch. 4‚Äì6 & 11 2A Tutorial 1: Twitter Feb 14, 2022 Cees notebook 2B Learning on Networks Feb 17, 2022 Cees notebook Jackson Ch. 8 2C Disease Transmission Feb 18, 2022 Cees notebook 3A no lecture Feb 21, 2022 3B Financial networks 1 Feb 24, 2022 Fabian notebook Allen & Gale (2000) 3C Financial networks 2 Feb 25, 2022 Fabian notebook Acemoglu et al. (2015) 4A Tutorial 2: SIR Feb 28, 2022 Cees notebook 4B Social Connectedness Mar  3, 2022 Fabian notebook Bailey et al. (2018) 4C Network Games Mar  4, 2022 Fabian Jackson Ch. 9 5A Tutorial 3: Financial stability Mar  7, 2022 Fabian notebook 5B Production networks 1 Mar 10, 2022 Fabian notebook Carvalho (2014) ,  Long & Plosser (1982) 5C Production networks 2 Mar 11, 2022 Fabian notebook Carvalho (2014) ,  Acemoglu et al. (2012) 6A Econometrics Mar 14, 2022 Cees 6B Tutorial 4: SCI Mar 17, 2022 Fabian 6C Tutorial 5: Covid Crisis Mar 18, 2022 Fabian"},{"url":"diffusion/DeGroot/","title":"Spread of Information and the DeGroot model","tags":["diffusion"],"text":" A Pluto.jl notebook v0.19.22 frontmatter chapter 3 section 1 order 1 title \"Spread of Information and the DeGroot model\" layout \"layout.jlhtml\" description \"\" tags \"diffusion\" using Markdown using InteractiveUtils This Pluto notebook uses bind for interactivity. When running this notebook outside of Pluto, the following 'mock version' of bind gives bound variables a default value instead of an error . macro bind def, element quote local iv try Base.loaded modules Base.PkgId Base.UUID \"6e696c72 6542 2067 7265 42206c756150\" , \"AbstractPlutoDingetjes\" .Bonds.initial value catch b missing end local el esc element global esc def Core.applicable Base.get, el ? Base.get el iv el el end end using PlutoUI using Graphs using GraphMakie graphplot, graphplot using CairoMakie using LinearAlgebra using LaTeXStrings latexstring, L str using Latexify latexify using SimpleWeightedGraphs SimpleWeightedDiGraph, weight using DataFrames DataFrame, stack, Not using AlgebraOfGraphics data, mapping, visual, draw using DataFrameMacros transform using GraphMakie automatic md\"\"\" `DeGroot.jl` | Version 1.2 | last updated Feb 21, 2023 \"\"\" md\"\"\" Exercises on the DeGroot model \"\"\" md\"\"\" Below there are some some adjacency matrices. \"\"\" begin T1 1 2 1 2 0 0 0 1 2 0 1 2 0 0 1 2 0 0 1 2 0 0 0 0 0 1 0 0 1 2 1 2 0 T2 1 2 1 2 0 0 0 1 0 0 0 0 1 2 0 0 1 2 0 0 0 0 0 1 0 0 1 2 1 2 0 T3 1 2 1 2 0 0 0 1 0 0 0 0 1 2 0 0 1 2 0 0 0 0 0 1 0 0 0 1 2 1 2 T4 1 2 1 2 0 0 0 1 0 0 0 0 1 2 0 0 1 2 0 0 0 0 0 1 0 0 0 1 0 Ts T1, T2, T3, T4 latexify. Ts end md\" Exercise 1 Simulate the DeGroot model for the networks ``T 1, \\ldots, T 4`` shown below. Plot the beliefs of agent node ``1, \\ldots, 5`` as a function of time, and check whether there is convergence , and if so, consensus . Explain what you observe in terms of the SCCs in the network and the links between them. \" b0 0.2, 0.4, 0.6, 0.8, 1.0 T selector bind T Select Ts . string. \"T \", 1 4 graph SimpleWeightedDiGraph T T^50 b0 function b series T, b0, N k 0 b b0 b ts b0' while k N b T b b ts b ts b' k 1 end return b ts end function b df T, b‚ÇÄ, N n nodes size T, 1 b ts b series T, b‚ÇÄ, N df DataFrame b ts, \"node i\" for i ‚àà 1 n nodes df transform df, t bycol 0 N end function b stacked T, b‚ÇÄ, N df b df T, b‚ÇÄ, N stack df, Not t , value name \"opinion\", variable name \"node\" end data b stacked T,b0,50 mapping t L\"time t \", opinion, color node visual Lines | draw md\" Exercise 2 Examine the structure of high powers of T i . For the cases without convergence also inspect consecutive high powers, such as 10000 and 10001 . Relate the obtained matrices to the simulation results of Exercise 1. \" T selector T^10 000 ‚ï†‚ïê‚ï° T4^10 001 ‚ï†‚ïê‚ï° md\" Exercise 3 Calculate the eigenvalues of T 1', \\ldots, T 4' . Determine the social influence vector s by inspecting the eigenvectors normalised such that the elements add up to 1 that correspond to the eigenvalues that are 1 . Interpret your results. \" T selector unit eigvals findall ‚âà 1 , eigvals T' unit eigvecs eigvecs T' ,unit eigvals real if real x isreal x ? real x x normalized eigvecs unit eigvecs . sum unit eigvecs, dims 1 | real if real md\"\"\" Appendix \"\"\" TableOfContents md\"\"\" Plotting helpers \"\"\" fixed layout Point2 Float64 2,1 , 1,2 , 1, 1 , 0,1 , 1,0 attr args... layout fixed layout, arrow size 20, elabels distance 15, nlabels distance 10, args... minimal args... xgridvisible false, xticksvisible false, xticklabelsvisible false, ygridvisible false, yticksvisible false, yticklabelsvisible false, args... md\"\"\" Packages \"\"\" md\"\"\" Named GraphPlot \"\"\" function text bbox textstring AbstractString, fontsize Union AbstractVector, Number , font, align, rotation, justification, lineheight glyph collection Makie.layout text textstring, fontsize, font, nothing, align, rotation, justification, lineheight, RGBAf 0,0,0,0 , RGBAf 0,0,0,0 , 0f0, 100 return Rect2f Makie.boundingbox glyph collection, Point3f 0 , Makie.to rotation rotation end begin recipe NamedGraphPlot, graph do scene scatter theme default theme scene, Scatter lineseg theme default theme scene, LineSegments labels theme default theme scene, Makie.Text Attributes graphplot attr Attributes , node attributes Scatter node color orange, lightgray, node strokewidth 0.5, node size automatic, node marker circle, node aspect regular, need for a better name node labels automatic, node font labels theme.fonts.regular, node fontsize labels theme.fontsize end function Makie.plot ngp NamedGraphPlot Extract attributes from plot object graph, graphplot attr, node color, node strokewidth, node size, node aspect, node marker, node labels, node font, node fontsize ngp Compute marker sizes out lift node labels, graph, node size, node fontsize, node font, node aspect do node labels, graph, node size, node fontsize, node font, node aspect if node labels automatic node labels string. 1 nv graph end Extract text sizes and layout accordingly label sizes widths text bbox string label , node fontsize, node font, center, center , 0f0, 0, 0 for label in node labels if regular use circle square, otherwise elipse rectangle if node aspect regular label sizes max pt... for pt in label sizes end We can specify markersize as a Vec2f, which is the eltype of label sizes. Thus, we can explicitly cause the node drawing to be large enough to accomodate the marker size. if node size automatic node size map x 1.7x . 0node fontsize, label sizes end node labels, label sizes, node size end lift node labels, label sizes, node size out node attr marker node marker, color node color, strokewidth node strokewidth, markersize node size, markerspace pixel, if hasproperty graphplot attr, node attr warn \"Ignoring node attr\" delete graphplot attr, node attr end gp graphplot ngp, graph graphplot attr..., node attr positions lift gp layout graph text ngp, positions text node labels, font node font, fontsize node fontsize, align center, center return ngp end end let fig Figure graphs SimpleWeightedDiGraph. Ts graphplot attr attr namedgraphplot fig 1,1 , graphs 1 graphplot attr, axis minimal title L\"T 1\" namedgraphplot fig 1,2 , graphs 2 graphplot attr, axis minimal title L\"T 2\" namedgraphplot fig 2,1 , graphs 3 graphplot attr, axis minimal title L\"T 3\" namedgraphplot fig 2,2 , graphs 4 graphplot attr, axis minimal title L\"T 4\" fig | as svg end namedgraphplot graph graphplot attr attr elabels string. weight. edges graph , axis minimal | as svg namedgraphplot graph graphplot attr attr elabels string. weight. edges graph , nlabels string. \"eigvec \", round. vec sum normalized eigvecs, dims 2 , digits 2 , axis minimal | as svg "},{"url":"diffusion/disease/","title":"Spread of Covid19 and the SIR model","tags":["diffusion"],"text":" A Pluto.jl notebook v0.19.22 frontmatter chapter 3 section 1 order 2 title \"Spread of Covid19 and the SIR model\" layout \"layout.jlhtml\" description \"\" tags \"diffusion\" using Markdown using InteractiveUtils This Pluto notebook uses bind for interactivity. When running this notebook outside of Pluto, the following 'mock version' of bind gives bound variables a default value instead of an error . macro bind def, element quote local iv try Base.loaded modules Base.PkgId Base.UUID \"6e696c72 6542 2067 7265 42206c756150\" , \"AbstractPlutoDingetjes\" .Bonds.initial value catch b missing end local el esc element global esc def Core.applicable Base.get, el ? Base.get el iv el el end end using PlutoUI Slider, TableOfContents, CheckBox, NumberField using Statistics mean using GeometryBasics Point2f0 using Graphs SimpleGraph, add edge , StarGraph, CycleGraph, WheelGraph, betweenness centrality, eigenvector centrality, edges, adjacency matrix, nv, ne using DataFrames DataFrame, groupby, rename , stack, unstack, leftjoin, leftjoin , Not using DataFrameMacros combine, transform , transform, groupby, subset, subset using Chain chain using CategoricalArrays CategoricalArrays, categorical, cut, levels using AlgebraOfGraphics, GraphMakie using CairoMakie using Makie Makie, Figure, Axis, Legend, Lines, lines , scatter , scatterlines, scatterlines , vlines , hidedecorations , ylims , cgrad, lift, Observable using NetworkLayout NetworkLayout, Shell using NearestNeighbors BallTree, knn using Distributions Distributions, LogNormal using PlutoTest test md\"\"\" `disease.jl` | Version 1.6 | last updated Feb 23, 2023 \"\"\" md\"\"\" Diffusion on Networks Modeling Transmission of Disease This notebook will be the basis for part of Lecture 3C and Assignment 3 . Here is what we will cover. 1. We will model the diffusion of disease on a network. We will analyze how the parameters of the model change the outcomes. \"\"\" md\"\"\" 2. We will show how various policies mitigate the spread of the disease. We will see how we can map social distancing and vaccination programs into the model. The plot below shows how the number of infected people decreases when we randomly pick 20% of the population. Can we improve the efficacy of the vaccination program by targeting specific people? \"\"\" md\"\"\" 3. In your assignment you will make to model a little richer by `` i `` separating the `R` state into dead and immune which includes recovered and vaccinated and `` ii `` taking into account age specific death case fatality rates. Can we now improve the efficacy of the vaccination program even more? 4. Is this economics? Yes and no. There have been many papers studying the economic impact of Covid. Many of them integrate some version of the SIR model into a macroeconomic model. If you are interested, you can have a look at the collection of covid economics resources https cepr.org content covid 19 by the CEPR, this blogpost https johnhcochrane.blogspot.com 2020 05 an sir model with behavior.html by John Cochrane or this paper https www.aeaweb.org articles?id 10.1257 jep.34.4.105 by an epidemiologist in the Journal of Economic Perspectives . \"\"\" md\"\"\" The SIR Model In the simplest case, there are three states. 1. `S`usceptible 2. `I`nfected 3. `R`emoved recovered or dead For your assignment you will split up the `R` state into immune and dead. \"\"\" begin abstract type State end struct S State end struct I State end struct R State end struct D State end Assignment end const States Union subtypes State ... md\" Define the transitions \" function transition I, par, node, args... kwargs... Œ¥, œÅ node x rand if x Œ¥ die D else if x œÅ Œ¥ recover or die R else I end end transition R, args... kwargs... R function transition S, par, node, adjacency matrix, is infected node id node inv prob 1.0 for i in is infected inv prob 1 par.p adjacency matrix i, node id end inv prob prod 1 par.p adjacency matrix i, node id for i in is infected, init 1.0 œÄ 1.0 inv prob rand œÄ ? I S end function iterate states new, states, adjacency matrix, par, node df is infected findall isa. states, I for node row ‚àà eachrow node df node id node row states new node id transition states node id , par, node row, adjacency matrix, is infected end states new end function iterate states, adjacency matrix, par, node df states new Vector States undef, N iterate states new, states, adjacency matrix, par, node df states new end md\"\"\" Simulate on a Simple Network ``\\rho s`` bind œÅ simple Slider 0.0 0.25 1.0, default 0.0, show value true recovery probability ``\\delta s`` bind Œ¥ simple Slider 0.0 0.25 1.0, default 0.0, show value true death rate ``p s`` bind p simple Slider 0.0 0.25 1.0, default 0.5, show value true infection probability \"\"\" simple graph CycleGraph 10 T simple 15 md\"\"\" ``t`` bind t0 simple NumberField 1 T simple, default 1 \"\"\" md\"\"\" Simulate on a Big Network \"\"\" md\"\"\" ``\\rho`` bind œÅ0 Slider 0.1 0.1 0.9, default 0.1, show value true recovery probability ``\\delta`` bind Œ¥0 Slider 0.0 0.02 0.2, default 0.04, show value true death rate ``p`` bind p0 Slider 0.1 0.1 0.9, default 0.3, show value true infection probability \"\"\" T big 100 period selector md\"\"\" ``t`` bind t0 NumberField 1 T big, default 20 \"\"\" period selector md\"\"\" Policies \"\"\" md\"\"\" Social Distancing \"\"\" p range 0.1 0.1 0.9 md\"\"\" School closures See last year's assignment https greimel.github.io networks course notebooks school closures \"\"\" md\"\"\" Vaccinations \"\"\" md\"\"\" ``t`` bind t0 vacc NumberField 1 T big, default 1 \"\"\" md\"\"\" It's really hard to see the difference, so let's use an alternative visualization. \"\"\" md\"\"\" Assignment 3 Whom to vaccinate? If you have 100 doses at your disposal, whom would you vaccinate? \"\"\" group members firstname \"Ella Louise\", lastname \"Flores\" , firstname \"Padraig\", lastname \"Cope\" , firstname \"Christy\", lastname \"Denton\" group number 99 if group number 99 || group members 1 .firstname \"Ella Louise\" && group members 1 .lastname \"Flores\" md\"\"\" danger \"Note \" Before you submit , please replace the randomly generated names in this cell 3bf0f92a 991d 42d3 ad30 28fb0acb3269 by the names of your group and put the right group number in this cell 1e2189d3 58c5 4f7d b76c 2e0ad5b7a803 . \"\"\" end md\"\"\" Task 1 Distinguishing `R`ecovered and `D`ead 3 points \"\"\" md\"\"\" üëâ Add a new state `D`ead. \"\"\" md\"\"\" üëâ Add a transition rule for `D`. \"\"\" transition D, args... kwargs... your code here md\"\"\" üëâ Go to section Define the transtions and adjust the transition rules for the other states if necessary. \"\"\" md\"\"\" Great You can now have a look how the simulations from the lecture have automatically updated. \"\"\" md\"\"\" Task 2 Introduce age specific death rates 2 points The death probabilities are highly heterogeneous across age groups. See for example this dated article in Nature. https www.nature.com articles s41586 020 2918 0 Let us assume there are the following age groups with age specific \\delta . Feel free to experiment a bit and change how these are computed. \"\"\" md\"\"\" We randomly assign each node into an age bin. This is visualized below. \"\"\" md\"\"\" We want to adjust the code so that it can handle node specific \\delta . The way we are going to do it is to pass a vector \\vec \\delta \\delta 1, \\ldots, \\delta N that holds the death probability for each node. üëâ Go the the definition of `transition I, ... `, make sure you understand the code snippet in the comment and uncomment the lines. \"\"\" md\"\"\" Task 3 Whom to vaccinate? 5 points Can you think of a way to improve the effectiveness of the vaccination program? If you have 100 doses at your disposal, whom would you vaccinate? \"\"\" function pseudo random N, n, offset 1 step N √∑ n range offset, step step, length n end md\"\"\" üëâ Decide which nodes you want to vaccinate and adjust the cell below. Make sure you only vaccinate `N vacc` nodes. \"\"\" answer3 md\"\"\" Your answer goes here ... \"\"\" md\"\"\" Before you submit ... üëâ Make sure you have added your names in this cell 3bf0f92a 991d 42d3 ad30 28fb0acb3269 and your group number in this cell 1e2189d3 58c5 4f7d b76c 2e0ad5b7a803 . üëâ Make sure that that all group members proofread your submission especially your little essay . üëâ Go to the very top of the notebook and click on the symbol in the very top right corner. Export a static html file of this notebook for submission. In addition, upload the source code of the notebook the .jl file . \"\"\" md\"\"\" Appendix to Assignment \"\"\" md\"\"\" Details on age specific infection fatality rates \"\"\" md\"\"\" The death probabilities are highly heterogeneous across age groups. See for example this article in Nature. https www.nature.com articles s41586 020 2918 0 We find that age specific IFRs estimated by the ensemble model range from 0.001% 95% credible interval, 0‚Äì0.001 in those aged 5‚Äì9 years old range, 0‚Äì0.002% across individual national level seroprevalence surveys to 8.29% 95% credible intervals, 7.11‚Äì9.59% in those aged 80 range, 2.49‚Äì15.55% across individual national level seroprevalence surveys . Markdown.MD Markdown.Admonition \"danger\", \"Beware \", md\"These data are outdated.\" Below find the data from supplementary table S3 from this article. \"\"\" md\"\"\" Get from infection fatality ratio to \\delta When the recovery rate is \\rho , the expected time infected is T I 1 \\rho . So we want the survival probability to 1 IFR 1 \\delta ^ T I . \"\"\" get Œ¥ from ifr ifr, œÅ 1 1 ifr 100 ^ œÅ md\"\"\" Appendix \"\"\" md\"\"\" Functions for the simulation \"\"\" function initial state N, infected nodes, recovered nodes fill with \"Susceptible\" init States S for i in 1 N init infected nodes . Ref I init recovered nodes . Ref R init end function initial state N, n infected spread out the desired number of infected people infected nodes 1 N√∑n infected N initial state N, infected nodes, end function simulate graph, par, T, init initial state nv graph , max nv graph √∑ 100, 1 node df DataFrame node id 1 nv graph , par... mat adjacency matrix graph N nv graph sim Matrix States undef, N, T sim ,1 . init for t 2 T iterate view sim, , t , view sim, , t 1 , mat, par, node df end sim end sim simple let g simple graph par p p simple node df DataFrame node id 1 nv g , Œ¥ Œ¥ simple, œÅ œÅ simple info node df sim simulate simple graph, par, T simple node df sim, g end md\"\"\" Processing the Simulated Data \"\"\" function ordered states states levels unique states order \"S\", \"I\", \"R\", \"D\" if levels ‚äÜ order return sorted order ‚à© levels else return levels end end label x DataType string Base.typename x .name label x label typeof x function tidy simulation output sim go from type to symbol S \"S\" sim1 label. sim make it a DataFrame with T columns and N rows df0 DataFrame sim1, auto rename df0, string. 1 size df0,2 add a column with node identifier df0.node id 1 size df0, 1 stack df to node id | t | state df stack df0, Not node id , variable name t, value name state make t numeric transform df, t parse Int, eval t , state bycol categorical state df end function fractions over time sim tidy sim tidy simulation output sim N, T size sim return chain tidy sim begin groupby t, state combine fraction length node id N put states into nice order transform state bycol levels state, ordered states state end end md\"\"\" Constructing the Figures \"\"\" function plot fractions figpos, t, sim, color dict, legpos nothing df fractions over time sim plt data df visual Lines mapping t AlgebraOfGraphics.L\"t\", fraction, color state \"\" visual Lines fg draw figpos, plt, palettes color collect color dict ax only fg .axis vlines ax, lift t , color gray50, linestyle dash, loose ylims ax, 0.05, 1.05 some attributes to make the legend nicer attr orientation horizontal, titleposition left, framevisible false if isnothing legpos leg legend legpos, fg attr... else leg nothing end ax fg, leg end function plot diffusion figpos, graph, sim, t, color dict kwargs... sim colors color dict label s for s in sim state as color t lift sim colors , t ax Axis figpos hidedecorations ax N, T size sim msize N 20 ? 15 N ‚â§ 100 ? 10 7 graphplot ax, graph node size msize, node color state as color t, kwargs... ax end function sir plot figpos, legpos, sim, graph, t kwargs... states ordered states label. subtypes State colors Makie.wong colors 5,2,3,1,6,4,7 color dict Dict s colors i for i,s in enumerate states ax f, leg plot fractions figpos 1,2 , t, sim, color dict, legpos ax d plot diffusion figpos 1,1 , graph, sim, t, color dict kwargs... ax f, ax d, leg end function compare sir sim1, sim2, graph t 1, kwargs... t Observable 1 fig Figure padding 0,0,0,0 legpos fig 1 2,2 panel1 fig 1,1 panel2 fig 2,1 axs1 sir plot panel1, legpos, sim1, graph, t kwargs... axs2 sir plot panel2, nothing, sim2, graph, t kwargs... axs1.leg.orientation vertical assert axes sim1, 2 axes sim2, 2 fig, t, T range axes sim1, 2 end function sir plot sim, graph t 1, kwargs... t Observable 1 fig Figure main fig fig 2,1 leg pos fig 1,1 sir plot main fig, leg pos, sim, graph, t kwargs... fig, t, T range axes sim, 2 end let sim, g sim simple out sir plot sim, g, layout Shell , node attr strokewidth 0.5, , t t0 simple out.fig end md\" Spatial graph \" adapted from David Gleich, Purdue University https www.cs.purdue.edu homes dgleich cs515 2020 julia viral spreading.html function spatial graph node positions degreedist LogNormal log 2 ,1 n length node positions coords matrix hcat Vector. node positions ... T BallTree coords matrix g SimpleGraph n for i 1 n draw the number of links `deg` deg min ceil Int, rand degreedist , n 1 use the `deg` closest nodes as neighbours idxs, dists knn T, coords matrix ,i , deg 1 for j in idxs if i j add edge g, i, j end end end g end function spatial graph N Int id 1 N x rand N y rand N node positions Point2f0. x, y spatial graph node positions , node positions end sim big let par p p0 graph, node positions spatial graph 1000 node df DataFrame node id 1 nv graph , œÅ œÅ0, Œ¥ Œ¥0 sim simulate graph, par, T big node df sim big sim, graph, node positions end big fig let sim, graph, node positions sim big attr layout node positions, node attr strokewidth 0.1 , edge width 0.5, edge color black, 0.3 , out sir plot sim, graph t t0, attr... out.fig end big fig graph, node positions spatial graph 1000 let state \"I\" fig Figure ax Axis fig 1,1 , title \" state when varying the infection probability\" node df DataFrame node id 1 nv graph , œÅ œÅ0, Œ¥ Œ¥0 for p in p range par p sim simulate graph, par, 100 node df df0 fractions over time sim filter state state , df0 lines df0.t, df0.fraction, label \"p p\", color blue, 1 p end Legend fig 1,2 , ax fig end vacc let N 1000 N vacc N √∑ 5 par p 0.1 graph, node positions spatial graph N node df DataFrame node id 1 nv graph , œÅ œÅ0, Œ¥ Œ¥0 vaccinated \"none\" , \"random\" pseudo random N, N vacc, 3 , place for your suggestions infected nodes pseudo random N, N √∑ 5, 1 sims map vaccinated do label, vacc nodes init initial state N, infected nodes, vacc nodes sim simulate graph, par, 100, init node df label sim end graph, node positions, sims sims end out vacc let attr layout vacc.node positions, node attr strokewidth 0.1 , edge width 0.5, edge color black, 0.3 , compare sir last. vacc.sims 1,2 ..., vacc.graph t t0 vacc, attr... end out vacc.fig fig vaccc let state \"I\" fig Figure ax Axis fig 1,1 , title \" state when vaccinating different groups\" for i, lab, sim in enumerate vacc.sims df0 fractions over time sim subset df0, state state lines df0.t, df0.fraction, label lab , color colors i end some attributes to make the legend nicer attr orientation horizontal, titleposition left, framevisible false leg Legend fig 2,1 , ax attr... fig end fig vaccc md\"\"\" Utils \"\"\" generate a list of points that can be used to plot the graph function edges as points graph, node positions edges as pts Point2f0 for e in edges graph push edges as pts, node positions e.src push edges as pts, node positions e.dst push edges as pts, Point2f0 NaN, NaN end edges as pts end md\"\"\" Package Environment \"\"\" md\"\"\" Data \"\"\" import CSV ifr csv CSV.File IOBuffer \"\"\" from to IFR pc 0 4 0.003 5 9 0.001 10 14 0.001 15 19 0.003 20 24 0.006 25 29 0.013 30 34 0.024 35 39 0.040 40 44 0.075 45 49 0.121 50 54 0.207 55 59 0.323 60 64 0.456 65 69 1.075 70 74 1.674 75 79 3.203 80 95 8.292 \"\"\" note the oldest age group is actually 80 ifr df0 chain ifr csv begin DataFrame transform age mean tuple from, to , age bin bycol cut to, 0, 40, 75, 100 end ifr df chain ifr df0 begin groupby age bin combine IFR pc mean IFR pc transform age group bycol 1 length age bin transform œÅ 1 7 transform Œ¥ get Œ¥ from ifr IFR pc, œÅ end age graph let N 1000 p 0.5 node df DataFrame node id 1 N, œÅ 0.5, Œ¥ 0.01 age group rand Distributions.Categorical 0.4, 0.35, 0.25 , N chain node df begin leftjoin , ifr df, on age group transform Œ¥ 20 Œ¥ end par p graph, node positions spatial graph N par, graph, node positions, node df end let graph, node positions, node df age graph age groups unique node df.age bin colors Makie.wong colors 5,2,3,1,6,4,7 color dict Dict s colors i for i,s in enumerate age groups node color color dict grp for grp ‚àà node df.age bin fig, ax, graphplot graph layout node positions, node color leg df label, element MarkerElement marker circle, color for label, color ‚àà pairs color dict | DataFrame leg df axislegend ax, leg df.element, leg df.label, \"age bin\" fig end vacc age let par, graph, node positions, node df age graph N nv graph info node df N vacc N √∑ 5 centr betweenness centrality graph split 50 vaccinated \"none\" , \"random\" pseudo random N, N vacc, 4 , \"central 1\" sortperm centr, rev true 1 N vacc , place your suggestions here infected nodes pseudo random N, N √∑ 10, 1 sims map vaccinated do label, vacc nodes init initial state N, infected nodes, vacc nodes sim simulate graph, par, 100, init node df label sim end graph, node positions, sims sims end fig vacc age let state isdefined D ? \"D\" \"I\" fig Figure ax Axis fig 1,1 , title \" state when vaccinating different groups\" for i, lab, sim in enumerate vacc age.sims df0 fractions over time sim filter state state , df0 lines df0.t, df0.fraction, label lab end axislegend ax fig end scatterlines ifr df0.age, ifr df0.IFR pc, axis xlabel \"age group\", ylabel \"infection fatality ratio % \" md\"\"\" Plotting \"\"\" md\"\"\" Spatial network \"\"\" md\"\"\" Other Stuff \"\"\" TableOfContents begin hint text Markdown.MD Markdown.Admonition \"hint\", \"Hint\", text almost text Markdown.MD Markdown.Admonition \"warning\", \"Almost there \", text still missing text md\"Replace `missing` with your answer.\" Markdown.MD Markdown.Admonition \"warning\", \"Here we go \", text keep working text md\"The answer is not quite right.\" Markdown.MD Markdown.Admonition \"danger\", \"Keep working on it \", text yays md\"Great \", md\"Yay ‚ù§\", md\"Great üéâ\", md\"Well done \", md\"Keep it up \", md\"Good job \", md\"Awesome \", md\"You got the right answer \", md\"Let's move on to the next section.\" correct text rand yays Markdown.MD Markdown.Admonition \"correct\", \"Got it \", text end if isdefined D if hasproperty States.b.b, b correct md\"You've successfully defined type `D`.\" else almost md\"You've successfully defined `D`. But you need to do it in the right place. Go to The SIR Model b8d874b6 648d 11eb 251c 636c5ebc1f42 and uncomment the line that defines `D`.\" end else keep working md\" Go to The SIR Model b8d874b6 648d 11eb 251c 636c5ebc1f42 and uncomment the line that defines `D`.\" end try transition D if transition D D correct md\"You've successfully specified the transition rule for `D`.\" else keey working md\"The transition rule for `D` doesn't seem to work correctly\" end catch e if e isa MethodError keep working md\"The transition rule for `D` is not yet defined.\" else keep working md\"The transition rule for `D` doesn't seem to work correctly\" end end hint md\"You can look at the section Define the transitions for inspiration.\" begin try test1 transition I , , Œ¥ 1, œÅ 0 , 0 D test2 transition I , , Œ¥ 0, œÅ 1 , 0 R test3 transition I , , Œ¥ 0, œÅ 0 , 0 I if test1 && test2 && test3 correct md\"It seems that you've successfully adjusted the transition rule for `I`. Note the other rules are not checked \" else keep working end catch keep working end end function wordcount text stripped text strip replace string text , r\"\\s\" \" \" words split stripped text, ' ', ' ', '.', ',', ' ', ' ', '\"', ' ', ' ', '\\'' length filter \"\" , words end test wordcount \" Hello, it's me. \" 4 test wordcount \"This doesn't really matter.\" 5 show words answer md\" approximately wordcount answer words \" function show words limit answer, limit count wordcount answer if count 1.02 limit return show words answer else return almost md\"You are at count words. Please shorten your text a bit, to get below limit words .\" end end limit3 300 show words limit answer3, limit3 md\"\"\" Now write a short essay describing your choice. Your simulation results are subject to random noise. Make sure you run you simulations multiple times to make sure they are robust. üëâ Describe how you would select nodes to be vaccinated üëâ Be accurate but concise. Aim at no more than limit3 words. \"\"\" members let names map group members do firstname, lastname firstname \" \" lastname end join names, \", \", \" & \" end md\"\"\" submitted by members group group number \"\"\" md\"\"\" Acknowledgement \"\"\" Markdown.MD Markdown.Admonition \"warning\", \"The design of this notebook is based on\", md\"\"\" Computational Thinking , a live online Julia Pluto textbook. computationalthinking.mit.edu https computationalthinking.mit.edu \"\"\" "},{"url":"diffusion/school-closures/","title":"Old assignment","tags":["diffusion"],"text":" A Pluto.jl notebook v0.19.22 frontmatter chapter 3 section 1 order 3 title \"Old assignment\" layout \"layout.jlhtml\" description \"\" tags \"diffusion\" using Markdown using InteractiveUtils using NetworkLayout using Graphs, SimpleWeightedGraphs using SparseArrays using Colors colorant str using DataFrames, DataFrameMacros using Chain chain using GraphMakie, AlgebraOfGraphics, CairoMakie using MarkdownLiteral markdown using CategoricalArrays using Random using PlutoTest test using PlutoUI md\"\"\" `school closures.jl` | Version 1.3 | last updated Feb 20, 2023 \"\"\" md\"\"\" Assignment from Last Year School Closures in the Covid 19 Pandemic \"\"\" md\"\"\" In this assignment we want to understand the effect of school closures on the dynamics of the pandemic. Children have a much lower probability of getting hospitalized. Would it still make sense to close schools to keep hospitalizations low? We construct a network of adults and children, where children are linked via schools, adults in their jobs and parents are linked to children. \"\"\" md\"\"\" We assume that `child`ren and `adult`s differ by their transition probabilities. Children do not get hospitalized ``\\chi 0`` , and they have a higher recovery rate ``\\rho``. All these parameters are made up. \"\"\" transitions df DataFrame member type \"child\", œá 0.0, œÅ 0.4 , member type \"adult\", œá 0.4, œÅ 0.3 md\"\"\" We also make assumptions about the transmission probabilities within families, workplaces and schools. \"\"\" transmission df DataFrame linktype family, p 0.3 , linktype school, p 0.3 , linktype work, p 0.3 md\"\"\" Task 1 Introduce hospitalized into the model 3 points üëâ Add a new state `H`ospitalized. \"\"\" begin abstract type State end struct S State end susceptible struct I State end infected struct H State end hospitalized struct R State end recovered end md\"\"\" üëâ Add a transition rule for `H`. You may assume that recovery rates are the same for those in and outside of hospital. \"\"\" function transition H, node, args... kwargs... œÅ node x rand if ... ... else ... end end md\"\"\" üëâ Go to section Define the transitions ade7f9b5 cf6e 4278 95e0 651691baa892 and adjust the transition rules for the other states if necessary. \"\"\" md\"\"\" Great You can now have a look how the simulations from the lecture have automatically updated. \"\"\" md\"\"\" Task 2 Flatten the curve of `H`ospitalized 4 points We consider a scenario from the start of a new wave with a small numer of infections at time zero. Without taking any measures the model predicts that the total number of people who will be hospitalized will exceed the maximum capacity. In order to prevent this from happening, your options are to announce a lockdown of either schools or workplaces on a pre specified set of future days from day 0. Lockdown days of schools are economically more costly than lockdown days of workplaces. Therefore, it is important to obtain insights on how effective school lockdowns are in terms of preventing the spreading of Covid 19. In this assignment you will use simulation of the spreading of Covid 19 under various scenarios to extract those insights, and subsequently formulate a motivated lockdown policy based on these insights. \"\"\" T 30 md\"\"\" Now it's your turn. üëâ Decide when you want to lockdown schools and adjust the cell below. Make sure you close schools no longer than 5 days in total. \"\"\" begin lockdown fill Symbol , T for t in 1 5 . 2 lockdown t school end lockdown end assert all lockdown .‚äÜ Ref school, work, family md\"\"\" üëâ Next include the possibility to lock down workplaces as well. Can the number of school lockdown days be reduced or even avoided at all? \"\"\" md\"\"\" üëâ Now write a short report describing your choice. Describe how you selected the lockdown period. Why are hospitalizations decreasing even though children never get hospitalized? Be accurate but concise. Aim at no more than 500 words. \"\"\" answer2 md\"\"\" Your answer goes here ... \"\"\" md\"\"\" Task 3 Main insights and reflection on the model and method used 3 points üëâ Finally write a short essay describing the main findings based on the model Describe what insights you obtained from the model. Explain the limitations of the model and the simulation setup. Be accurate but concise. Aim at no more than 500 words. \"\"\" answer3 md\"\"\" Your answer goes here ... \"\"\" md\"\"\" Before you submit ... üëâ Make sure you have added your names and your group number in the cells below d73b9db2 742d 4c75 9ff0 2cdce26a8ec8 . üëâ Make sure that that all group members proofread your submission especially your little essay . üëâ Go to the very top of the notebook and click on the symbol in the very top right corner. Export a static html file of this notebook for submission. The source code is embedded in the html file. \"\"\" group members firstname \"Ella Louise\", lastname \"Flores\" , firstname \"Padraig\", lastname \"Cope\" , firstname \"Christy\", lastname \"Denton\" group number 99 if group number 99 || group members 1 .firstname \"Ella Louise\" && group members 1 .lastname \"Flores\" md\"\"\" danger \"Note \" Before you submit , please replace the randomly generated names above by the names of your group and put the right group number in this cell d73b9db2 742d 4c75 9ff0 2cdce26a8ec8 . \"\"\" end md\"\"\" Setting up the SIR model \"\"\" const States Union subtypes State ... md\" Define the transitions \" function transition I, node, args... kwargs... œÅ, œá node x rand if x œÅ recover R elseif ... ... else infected I end end transition R, args... kwargs... R md\"\"\" Helper functions \"\"\" function get edge i, j, edge df sorted i, j minmax i, j subset edge df sorted, src i, dst j end function get edge fast i, j, edge df sorted src, dst minmax i, j i src from findfirst src , edge df sorted.src if isnothing i src from info i, j end i src to findfirst src , edge df sorted.src i src from end src rows edge df sorted i src from end, if isnothing i src to src rows src rows 1 i src to 1, end i row findfirst dst , src rows.dst if isnothing i row info i, j end src rows i row, end function transition S, node, adjacency matrix, is infected, edge df sorted DataFrame, lockdown node id node inv prob 1.0 for i in is infected if adjacency matrix node id, i 0 p 0 else p, linktype get edge fast node id, i, edge df sorted if linktype ‚àà lockdown p 0 end end inv prob 1 p end inv prob prod 1 par.p adjacency matrix i, node for i in is infected, init 1.0 œÄ 1.0 inv prob rand œÄ ? I S end function iterate states new, states, adjacency matrix, edge df sorted, node df1, lockdown is infected findall isa. states, I for i in 1 size adjacency matrix, 1 node row node df1 i, assert node row.node id i states new i transition states i , node row, adjacency matrix, is infected, edge df sorted, lockdown end states new end function iterate states, adjacency matrix, par, lockdown states new Vector States undef, N iterate states new, states, adjacency matrix, par, lockdown states new end let edge df sorted xx sort edge df, src, dst i, j 478, 479 1, 161 t1 elapsed get edge i, j, edge df sorted xx t2 elapsed get edge fast i, j, edge df sorted xx t2 t1 1 end md\"\"\" Behind the Scenes Constructing the Network \"\"\" md\"\"\" Nodes \"\"\" setup N locations 10, N hh 200, N employers 40 markdown \"\"\" details summary Click on arrow for details summary `N setup.N hh ` households in `N locations setup.N locations ` different locations households families are modeled as complete networks , variable family size with and without children, sometimes single parents all children of same location go to same school modeled as a complete network adults are linked through their job there are `N employers setup.N employers ` employers, each modeled as a complete network details \"\"\" md\"\"\" In the plot below, the red dots are children, and the green dots are adults. The setup.N locations clusters of red dots are schools. \"\"\" function member type member id if member id 1 return \"adult\" elseif member id 2 if rand 2 3 return \"adult\" else single parent return \"child\" end else return \"child\" end end node df let Random.seed 5679 N hh, N locations, N employers setup household size rand 1 4, N hh chain begin DataFrame hh id 1 N hh transform school district bycol rand 1 N locations, N hh groupby hh id, school district combine member id 1 rand 1 4 transform member type member type member id transform node id bycol 1 length hh id transform employer member type \"adult\" ? N locations rand 1 N employers school district transform node color member type \"adult\" ? colorant\"green\" colorant\"red\" end end md\"\"\" Edges \"\"\" begin TP typeof i 1, j 1, linktype family edge list TP families gdf chain node df begin groupby hh id end for df in gdf for i,j ‚àà Iterators.product df.node id, df.node id i ‚â† j && push edge list, i, j, linktype family end end schools employers gdf chain node df begin groupby employer end for df in gdf for i,j ‚àà Iterators.product df.node id, df.node id if only unique df.employer ‚â§ setup.N locations linktype school i ‚â† j && push edge list, i, j, linktype else linktype work i ‚â† j && push edge list, i, j, linktype end end end n v size node df, 1 edge df00 DataFrame edge list edge df0 chain edge df00 begin groupby i, j combine first, end g SimpleGraph sparse edge df0.i, edge df0.j, 1, n v, n v edge df chain edges g begin DataFrame leftjoin , edge df0, on src i, dst j end end begin positions Spring g layout positions end md\"\"\" Plotting the network \"\"\" fg graphplot g layout, node df.node color, node size 7, edge width 0.3, transmission probability. edge df.p, edge df.linktype, lockdown , edge color black, 0.5 fg md\"\"\" Appendix \"\"\" md\"\"\" Functions for the simulation \"\"\" function initial state N, infected nodes, recovered nodes fill with \"Susceptible\" init States S for i in 1 N init infected nodes . Ref I init recovered nodes . Ref R init end function initial state N, n infected spread out the desired number of infected people infected nodes 1 N√∑n infected N initial state N, infected nodes, end function simulate graph, T, edge df sorted, node df1, init initial state nv graph , max nv graph √∑ 200, 1 lockdown fill none, T mat adjacency matrix graph N nv graph sim Matrix States undef, N, T sim ,1 . init for t 2 T iterate view sim, , t , view sim, , t 1 , mat, edge df sorted, node df1, lockdown t end sim end md\"\"\" Processing the Simulated Data \"\"\" function ordered states states levels unique states order \"S\", \"I\", \"H\", \"R\", \"D\" if levels ‚äÜ order return sorted order ‚à© levels else return levels end end label x DataType string Base.typename x .name label x label typeof x function tidy simulation output sim go from type to symbol S \"S\" sim1 label. sim make it a DataFrame with T columns and N rows df0 DataFrame sim1, auto rename df0, string. 1 size df0,2 add a column with node identifier df0.node id 1 size df0, 1 stack df to node id | t | state df stack df0, Not node id , variable name t, value name state make t numeric transform df, t parse Int, eval t , state bycol categorical state df end function fractions over time sim tidy sim tidy simulation output sim N, T size sim return chain tidy sim begin groupby t, state combine fraction length node id N put states into nice order transform state bycol levels state, ordered states state end end md\"\"\" Constructing the Figures \"\"\" function plot fractions figpos, t, sim, color dict legpos nothing, hline missing df fractions over time sim plt data df visual Lines mapping t AlgebraOfGraphics.L\"t\", fraction, color state \"\" visual Lines fg draw figpos, plt, palettes color collect color dict ax only fg .axis vlines ax, lift t , color gray50, linestyle dash, loose if ismissing hline hlines ax, hline, color red, 50 , linestyle dash end ylims ax, 0.05, 1.05 some attributes to make the legend nicer attr orientation horizontal, titleposition left, framevisible false if isnothing legpos leg legend legpos, fg attr... else leg nothing end ax fg, leg end function plot diffusion figpos, graph, sim, t, color dict kwargs... sim colors color dict label s for s in sim state as color t lift sim colors , t ax Axis figpos hidedecorations ax N, T size sim msize N 20 ? 10 N 100 ? 5 3 graphplot ax, graph node size msize, node color state as color t, kwargs... ax end function sir plot figpos, legpos, sim, graph, t hline missing, kwargs... states ordered states label. subtypes State colors Makie.wong colors 5,2,3,1,6,4,7 color dict Dict s colors i for i,s in enumerate states ax f, leg plot fractions figpos 1,2 , t, sim, color dict legpos, hline ax d plot diffusion figpos 1,1 , graph, sim, t, color dict kwargs... ax f, ax d, leg end function compare sir sim1, sim2, graph kwargs... t Observable 1 fig Figure padding 0,0,0,0 legpos fig 1 2,2 panel1 fig 1,1 panel2 fig 2,1 axs1 sir plot panel1, legpos, sim1, graph, t kwargs... axs2 sir plot panel2, nothing, sim2, graph, t kwargs... axs1.leg.orientation vertical assert axes sim1, 2 axes sim2, 2 fig, t, T range axes sim1, 2 end function sir plot sim, graph kwargs... t Observable 1 fig Figure main fig fig 2,1 leg pos fig 1,1 sir plot main fig, leg pos, sim, graph, t kwargs... fig, t, T range axes sim, 2 end out big let hospital capacity 0.1 node df1 leftjoin node df, transitions df, on member type edge df sorted chain edge df begin sort src, dst leftjoin , transmission df, on linktype end Random.seed 1502 sim simulate g, T, edge df sorted, node df1 lockdown attr layout, node attr strokewidth 0.1 , edge width 0.5, edge color black, 0.3 , out big sir plot sim, g hline hospital capacity, attr... end out big.fig md\"\"\" Package environment \"\"\" md\"\"\" Assignment infrastructure \"\"\" members let names map group members do firstname, lastname firstname \" \" lastname end join names, \", \", \" & \" end md\"\"\" submitted by members group group number \"\"\" function wordcount text stripped text strip replace string text , r\"\\s\" \" \" words split stripped text, ' ', ' ', '.', ',', ' ', ' ', '\"', ' ', ' ', '\\'' length filter \"\" , words end test wordcount \" Hello, it's me. \" 4 test wordcount \"This doesn't really matter.\" 5 show words answer md\" approximately wordcount answer words \" begin hint text Markdown.MD Markdown.Admonition \"hint\", \"Hint\", text almost text Markdown.MD Markdown.Admonition \"warning\", \"Almost there \", text still missing text md\"Replace `missing` with your answer.\" Markdown.MD Markdown.Admonition \"warning\", \"Here we go \", text keep working text md\"The answer is not quite right.\" Markdown.MD Markdown.Admonition \"danger\", \"Keep working on it \", text yays md\"Great \", md\"Yay ‚ù§\", md\"Great üéâ\", md\"Well done \", md\"Keep it up \", md\"Good job \", md\"Awesome \", md\"You got the right answer \", md\"Let's move on to the next section.\" correct text rand yays Markdown.MD Markdown.Admonition \"correct\", \"Got it \", text end if isdefined H if hasproperty States.b.b, b correct md\"You've successfully defined type `H`.\" else almost md\"You've successfully defined `H`. But you need to do it in the right place. Uncomment the line that defines `H`.\" end else hint md\"Uncomment the line that defines `H`.\" end try test0 transition H , œÅ 0, H test1 transition H , œÅ 1, R if test0 && test1 correct md\"You've successfully specified a transition rule for `H`.\" else keep working md\"The transition rule for `H` doesn't seem to work correctly\" end catch e if e isa MethodError keep working md\"The transition rule for `H` is not yet defined.\" else keep working md\"The transition rule for `H` doesn't seem to work correctly\" end end hint md\"You can look at the section Define the transitions for inspiration.\" begin try test1 transition I , œá 1, œÅ 0 , 0 H test2 transition I , œá 0, œÅ 1 , 0 R test3 transition I , œá 0, œÅ 0 , 0 I if test1 && test2 && test3 correct md\"It seems that you've adjusted the transition rule for `I`. Note the other rules are not checked \" else keep working end catch keep working end end if answer2 md\"\"\" Your answer goes here ... \"\"\" keep working md\"Place your cursor in the code cell and replace the dummy text, and evaluate the cell.\" elseif wordcount answer2 1.1 500 almost md\"Try to shorten your text a bit, to get below 500 words.\" else correct md\"Great, we are looking forward to reading your answer \" end function show words limit answer, limit count wordcount answer if count 1.02 limit return show words answer else return almost md\"You are at count words. Please shorten your text a bit, to get below limit words .\" end end show words limit answer2, 500 show words limit answer3, 500 TableOfContents md\"\"\" Acknowledgement \"\"\" Markdown.MD Markdown.Admonition \"warning\", \"The design of this notebook is based on\", md\"\"\" Computational Thinking , a live online Julia Pluto textbook. computationalthinking.mit.edu https computationalthinking.mit.edu \"\"\" "},{"url":"financial-networks/risk-sharing/","title":"Risk sharing in financial networks","tags":["financial-networks"],"text":" A Pluto.jl notebook v0.19.22 frontmatter chapter 5 section 1 order 1 title \"Risk sharing in financial networks\" layout \"layout.jlhtml\" description \"\" tags \"financial networks\" using Markdown using InteractiveUtils This Pluto notebook uses bind for interactivity. When running this notebook outside of Pluto, the following 'mock version' of bind gives bound variables a default value instead of an error . macro bind def, element quote local iv try Base.loaded modules Base.PkgId Base.UUID \"6e696c72 6542 2067 7265 42206c756150\" , \"AbstractPlutoDingetjes\" .Bonds.initial value catch b missing end local el esc element global esc def Core.applicable Base.get, el ? Base.get el iv el el end end using Graphs using Optim using ForwardDiff using Chain chain using DataFrames using DataFrameMacros using AlgebraOfGraphics using CairoMakie, Makie using GraphMakie using NetworkLayout using LaTeXStrings latexstring, L str using Random using PlutoUI Slider using NamedTupleTools delete using PlutoUI md\"\"\" `risk sharing.jl` | Version 1.2 | last updated Mar 6, 2023 \"\"\" md\"\"\" Risk Sharing and Systemic Risk in Financial Networks A financial network is a network of promises a liability is a promised payment between banks or other financial institutions üëâ Part A Risk sharing What's good about financial networks? \\ based on Allen & Gale, 2000 https www.jstor.org stable 10.1086 262109 , Journal of Political Economy I. banks provide liquidity II. banks are fragile subject to bank runs III. an interbank market can avoid default , prevent bank runs Part B Systemic Risk What's bad about financial networks? \\ based on Acemoglu, Ozdaglar & Tahbaz Salehi, 2015 https www.aeaweb.org articles?id 10.1257 aer.20130456 , American Economic Review I. Model setup II. insolvency and bankruptcy in the payment equilibrium III. financial contagion IV. stability and resilience of financial networks more interbank lending leads to higher fragility densely connected networks are robust, yet fragile with big shocks , we want to have disconnected components \"\"\" md\"\"\" Part A Risk sharing in financial networks We study the model of Allen & Gale 2000 , which builds on the Diamond & Dybvig 1983 of bank runs. \"\"\" md\"\"\" If you want to read more about the Diamond Dybvig model a true classic Diamond & Dybvig 1983 https www.jstor.org stable 1837095 Bank Runs, Deposit Insurance, and Liquidity, Journal of Political Economy Diamond 2007 https www.richmondfed.org media RichmondFedOrg publications research economic quarterly 2007 spring pdf diamond.pdf A simple exposition of the Diamond Dybvig model, Richmond Fed Economic Quarterly \"\"\" md\"\"\" I. Banks provide liquidity A story A simple world We are in a simple world. At period ``t 0`` there are is a big population, where each person owns 1 kg of potatoes the initial endowment is 1 . Preferences At this moment `` t 0 ``, nobody is hungry. Everybody knows that they will be hungry at some point . But they don't know when either in period ``1`` or period ``2``. The utility of an agent is ```math \\begin cases u c 1 & \\text with probability \\gamma \\\\ u c 2 &\\text with probability 1 \\gamma \\end cases ``` Investment opportunities There are two options. Either store the potatoes or plant potatoes to grow more of them. Storage has a gross return of ``1`` no gain, no loss and the stored potatoes are a liquid asset. They can be eaten in either of the two periods. Each kilogram of planted potatos yield ``1.5`` kilograms of potatoes in period 2. The gross return is ``R 1.5`` if held to maturity . Planted potatoes are an illiquid asset . If you dig up the planted potatoes in the intermediate period they will have lost their quality and not be very enjoyable. So, in case of early liquidation the gross return is ``r \\in 0, 1 ``. \"\"\" md\"\"\" Investment decision of an agent Each agent can split up their initial endowment 1kg of potatoes , plant fraction ``x`` and store fraction ``1 x``. When the agents wakes up hungry in period 1, the agent will dig up liquidate the planted potatoes and have a consumption of ``c 1 1 x r x``. If the agent wake is not hungry in period 1, she will keep the ``x`` potatoes in the ground, and the `` 1 x `` potatoes in the storage and have a consumption of ``c 2 1 x R x`` in period 2. ```math \\begin align &\\max x \\mathbb E U c 1, c 2 \\gamma u c 1 1 \\gamma u c 2 \\\\ &\\begin aligned \\text such that & c 1 1 x r x \\\\ & c 2 1 x R x \\end aligned \\end align ``` \"\"\" u log ùîºU c‚ÇÅ, c‚ÇÇ Œ≥ Œ≥ u c‚ÇÅ 1 Œ≥ c‚ÇÇ sliders md\"\"\" ``R`` bind R Slider 0.5 0.05 1.5, default 1.1, show value true ``r`` bind r Slider 0.0 0.05 1.0, default 0.1, show value true ``\\gamma`` bind Œ≥ Slider 0.0 0.05 1.0, default 0.5, show value true \"\"\" sliders let function obj x Œ≥ Œ≥ c‚ÇÅ 1 x x r c‚ÇÇ 1 x x R ùîºU c‚ÇÅ, c‚ÇÇ Œ≥ end res maximize obj, 0, 1 x opt Optim.maximizer res info x opt xx 0.0 0.05 1.0 fig Figure ax Axis fig 1,1 , xlabel L\"fraction invested x \", ylabel \"expected utility\" lines ax, xx, obj. xx vlines ax, x opt, linestyle dash, loose , color gray fig end md\"\"\" If the return from liquidation r is sufficiently low, agents will not invest in the liquid asset x 0 . The fact that nobody is investing in the asset is not very satisfying. Isn't it somehow possible to predict how many agents will be hungry in period 2 ? Then we could invest at least plant some potatoes and distribute the returns somehow. \"\"\" md\"\"\" The social optimum What would a benevolent social planner do? The planner can collect all initial endowments, make an investment decision and distribute the proceeds. The planner maximizes the ex ante expected utility of an agent. ```math \\begin align & \\max x, \\ell \\in 0,1 \\gamma u c 1 1 \\gamma u c 2 \\\\ &\\begin aligned \\text such that && \\gamma c 1 & 1 x \\ell r x \\\\ && 1 \\gamma c 2 & 1 \\ell R x \\end aligned \\end align ``` \"\"\" c‚ÇÅ x, ‚Ñì Œ≥ Œ≥ 1 x ‚Ñì x r Œ≥ c‚ÇÇ x, ‚Ñì Œ≥ Œ≥ 1 ‚Ñì x R 0.0 ? 0.0 1 ‚Ñì x R 1 Œ≥ function obj args Œ≥ Œ≥ x, ‚Ñì args ùîºU c‚ÇÅ x, ‚Ñì Œ≥ , c‚ÇÇ x, ‚Ñì Œ≥ Œ≥ end social optimum let neg obj args obj args res optimize neg obj, 0.0, 0.0 , 1.0, 1.0 , 0.5, 0.5 , Fminbox GradientDescent x opt, ‚Ñì opt Optim.minimizer res x opt, ‚Ñì opt, c‚ÇÅ opt c‚ÇÅ x opt, ‚Ñì opt Œ≥ , c‚ÇÇ opt c‚ÇÇ x opt, ‚Ñì opt Œ≥ end let x opt, ‚Ñì opt social optimum xx range 0.0, 0.99, 100 ‚Ñì‚Ñì 0.0 0.05 1.0 objj obj x, ‚Ñì for ‚Ñì ‚àà ‚Ñì‚Ñì, x ‚àà xx fig Figure ax Axis fig 1,1 , xlabel \"fraction invested\", ylabel \"expected utility\", title latexstring \"expected utility for \\ \\\\ell^ round ‚Ñì opt, digits 4 \\ \" ax Axis3 fig 1,1 , xlabel \"fraction invested\", ylabel \"fraction liquidated\", zlabel \"expected utility\" surface ax, ‚Ñì‚Ñì, xx, objj lines ax, xx, obj x, ‚Ñì opt for x ‚àà xx vlines ax, x opt, linestyle dash, loose , color gray fig end sliders md\"\"\" We can see that in the social optimum, there is a significant investment into the liquid asset. We can also see, that the optimal expected utility is higher than in the individual optimum above. In the real world, there is no benevolent social planner. So the question is How can we achieve the social optimum? TL DR banks. \"\"\" md\"\"\" The role of a bank Agents deposit their initial potatoes in the bank. The investment decision is delegated to the bank, who promises a fixed return `` c 1, c 2 `` depending on the time of withdrawal. The banks know that the fraction ``\\gamma`` of people will withdraw in period 1 because they are hungry and `` 1 \\gamma `` will withdraw in period 2. The bank needs to make sure that ``c 2 \\geq c 1``, otherwise late agents have an incentive to withdraw their deposits in period 1 and store them until period 2 . We assume that banks act on a competitive market, so agents will only choose to deposit in a bank that provides the optimal contract . Thus, banks will only operate if they maximize ```math \\begin align & \\max x, \\ell \\in 0,1 \\gamma u c 1 1 \\gamma u c 2 \\\\ &\\begin aligned \\text such that && \\gamma c 1 & 1 x ‚Ñì r x \\\\ && 1 \\gamma c 2 & 1 ‚Ñì R x \\\\ && c 2 &‚â• c 1 \\end aligned \\end align ``` This problem is the same as the planner's problem , except that the incentive compatibility constraint IC ``c 2 \\geq c 1`` is added. It turns out, that under some conditions for the utility function `u` the IC will always be satisfied. So the presence of banks will lead to the welfare maximizing outcome in this model. \"\"\" let x opt, ‚Ñì opt social optimum xx range 0.05, 0.95, 100 fig Figure ax1 Axis fig 1,1 , xlabel L\"fraction invested x \" ax2 Axis fig 2,1 , xlabel L\"fraction invested x \" lines ax1, xx, c‚ÇÅ. xx, ‚Ñì opt , label L\"c 1\" lines ax1, xx, c‚ÇÇ. xx, ‚Ñì opt , label L\"c 2\" lines ax2, xx, ùîºU. c‚ÇÅ. xx, ‚Ñì opt , c‚ÇÇ. xx, ‚Ñì opt Œ≥ , label L\"\\bbE U\" vlines . ax1, ax2 , x opt, linestyle dash, loose , color gray axislegend. ax1, ax2 linkxaxes ax1, ax2 hidexdecorations ax1, grid false fig end md\"\"\" II. Financial fragility Bank runs What will happen, if a fraction ``\\tilde \\omega \\omega`` withdraws money in period ``t 1``? The bank will have to dig up some of its potatoes to fill the gap. This means that the payout in period two will have to be reduced there are not enough potatoes left . As soon as the expected payout ``\\tilde c 2`` becomes small enough, there will be a bank run . If the ``\\tilde c 2 c 1`` the incentive compatibility constraint is violated and the \"late\" types will start to withdraw their money. \"\"\" begin x opt, ‚Ñì opt, c‚ÇÅ opt, c‚ÇÇ opt social optimum liquid ‚Ñì 1 x opt ‚Ñì x opt r withdrawal œâ c‚ÇÅ opt œâ end md\"additional withdrawers Œµ bind Œµ Slider 0 0.01 1 Œ≥ , default 0.05, show value true \" œâ Œ≥ Œµ liquid ‚Ñì opt withdrawal œâ withdrawal œâ ‚â§ liquid ‚Ñì opt function realized payout œâ, opt ib payable 0.0, ib deposit 0.0 x opt, ‚Ñì opt, c‚ÇÅ opt, c‚ÇÇ opt opt liquid ‚Ñì 1 x opt ‚Ñì x opt r ib payable withdrawal œâ c‚ÇÅ opt œâ shortfall0 max withdrawal œâ liquid 0.0 , 0.0 if 0 ‚â§ shortfall0 ‚â§ ib deposit ib withdrawal shortfall0 else shortfall ib deposit ib withdrawal ib deposit end info shortfall0 shortfall shortfall0 ib withdrawal ‚Ñì new clamp shortfall x opt r , 0.0, 1.0 c‚ÇÅ new c‚ÇÅ x opt, ‚Ñì new, Œ≥ max Œ≥, œâ c‚ÇÇ new c‚ÇÇ x opt, ‚Ñì new, Œ≥ max Œ≥, œâ if c‚ÇÇ new c‚ÇÅ new && œâ 1.0 IC violated everybody withdraws early œâÃÉ 1.0 return œâ, delete realized payout œâÃÉ, opt , œâ ... end œâ, c‚ÇÅ opt, c‚ÇÇ opt, ‚Ñì opt, c‚ÇÅ new, c‚ÇÇ new, ‚Ñì new end realized payout œâ, social optimum let Œµ 0.2 ib deposit 0.2 bank1 realized payout Œ≥ Œµ, social optimum ib deposit bank2 realized payout Œ≥ Œµ, social optimum ib deposit chain bank1 bank2 begin DataFrame select œâ, ‚Ñì new, ib withdrawal end end md\" hidden cell \" sliders 1.1, 0.4. 0.5 let df map 0 0.005 1 do œâ Œµ œâ Œ≥ Œµ, realized payout œâ, social optimum ... end | DataFrame chain df begin select Not œâ stack Not Œµ transform astable begin tmp split variable, \" \" variable tmp 1 mod tmp 2 \"opt\" ? \"planned\" \"realized\" end data mapping Œµ \"additional withdrawers Œµ\", value, color variable, linestyle mod \"\" visual Lines draw end end md\"\"\" III. Risk sharing in the interbank market Now, let's suppose that there are ``N`` banks. All banks face the same decision problem, so they will offer the same deposit contract `` c 1, c 2 ``. Agents will randomly pick one of the two banks the outcome will be the same as before. Let ``\\omega i`` be the fraction of bank ``i``'s customers that withdraws early. The average fraction of withdrawers is ``\\gamma \\frac 1 N \\sum i 1 ^N \\omega i``. We assume that there is idiosychratic i.e. bank specific risk , but no aggregate risk . That is, banks don't know ``\\omega i``, but they know ``\\gamma``. Can the social optimum still be achieved? TL DR Yes, if there is an interbank market \"\"\" md\"\"\" Banks can serve at most ``\\gamma`` early withdrawals without liquidating assets. If they are faced with ``\\omega i \\gamma`` early customers, the bank as excess liquidity needs of `` \\omega i \\gamma c 1`` in period 1. If faced with ``\\omega i \\gamma`` early customers, the bank has excess liquidity in period 1, but a shortage of funds of `` 1 \\gamma 1 \\omega i c 2 \\omega i \\gamma c 2`` in period 2. Since ``0 \\leq \\omega i \\leq 1``, the maximal liquity need in period 1 is ```math 1 \\gamma c 1 ``` Suppose banks can deposit at the same terms as agents. So for each unit deposited, agents get ``c 1`` if withdrawn in period ``t 1`` and ``c 2`` if withdrawn in period ``t 2``. Now suppose that each has total deposits of ``\\bar y 1 \\gamma``. \"\"\" md\"\"\" illustration missing \"\"\" let ib deposit 0.2 œâ Œ≥ 0.2 shortfall0 max œâ c‚ÇÅ opt Œ≥ c‚ÇÅ opt, 0.0 if 0 ‚â§ shortfall0 ib deposit ib withdrawal shortfall0 c‚ÇÅ c‚ÇÅ opt ‚Ñì 0.0 shortfall 0.0 elseif shortfall0 ‚â§ ib deposit x opt r ib withdrawal ib deposit shortfall shortfall0 ib withdrawal ‚Ñì shortfall x opt r Œ≥ œâ c‚ÇÅ c‚ÇÅ opt else ib withdrawal ib deposit ‚Ñì 1.0 c‚ÇÅ liquid ‚Ñì ib withdrawal œâ end Œ∂ excess liquidity liquid ‚Ñì ib withdrawal œâ c‚ÇÅ Œ∂ next next period c‚ÇÇ opt œâ Œ≥ Œ∂ next, ib withdrawal, œâ, ‚Ñì, c‚ÇÅ, Œ∂, shortfall0, shortfall end md\"\"\" Appendix \"\"\" md\"\"\" Package environment \"\"\" md\"\"\" Graphs \"\"\" md\"\"\" Numerical Methods \"\"\" md\"\"\" Data \"\"\" md\"\"\" Plotting \"\"\" md\"\"\" Other \"\"\" TableOfContents "},{"url":"financial-networks/systemic-risk/","title":"Systemic risk in financial networks","tags":["financial-networks"],"text":" A Pluto.jl notebook v0.19.22 frontmatter chapter 5 section 2 order 1 title \"Systemic risk in financial networks\" layout \"layout.jlhtml\" description \"\" tags \"financial networks\" using Markdown using InteractiveUtils This Pluto notebook uses bind for interactivity. When running this notebook outside of Pluto, the following 'mock version' of bind gives bound variables a default value instead of an error . macro bind def, element quote local iv try Base.loaded modules Base.PkgId Base.UUID \"6e696c72 6542 2067 7265 42206c756150\" , \"AbstractPlutoDingetjes\" .Bonds.initial value catch b missing end local el esc element global esc def Core.applicable Base.get, el ? Base.get el iv el el end end using Revise using PlutoUI NumberField using MarkdownLiteral markdown using PlutoUI Select using LinearAlgebra dot using HypertextLiteral using MarkdownLiteral mdx using StructArrays using PlutoUI PlutoUI, TableOfContents, Slider, CheckBox, as svg using StatsBase weights using CategoricalArrays using DataAPI refarray using Graphs, SimpleWeightedGraphs using NetworkLayout using LinearAlgebra I using PlutoLinks using PlutoTeachingTools using Chain chain using GeometryBasics Rect, Vec2f0 using DataFrames, DataFrameMacros using Roots find zero using Colors colorant str using Statistics mean using GraphMakie using NamedTupleTools using CairoMakie key str, lift, L str using CairoMakie, AlgebraOfGraphics, Colors using LaTeXStrings using PlutoTest test md\"\"\" `systemic risk.jl` | Version 2.3 | last updated March 10, 2023 \"\"\" present button space 0 md\"\"\" Systemic Risk in Financial Networks based on Acemoglu, Ozdaglar & Tahbaz Salehi, 2015 https www.aeaweb.org articles?id 10.1257 aer.20130456 , American Economic Review \"\"\" md\"\"\" Overview Contagion on Financial Networks Financial network banks linked by interbank lending \"\"\" aside figure fig aside md\" as svg fig \" md\"\"\" I. Model Setup \"\"\" md\"\"\" Model I Banks \"\"\" md\"\"\" Model II Firms fixed initial size dividend ``\\delta a Œµ`` paid to bank ``Œµ`` is a shock fraction ``\\tilde ‚Ñì`` can be liquidated recover ``\\tilde ‚Ñì Œ∂ A`` final pay off `` 1 \\tilde ‚Ñì A`` \"\"\" dividend a , Œµ max a Œµ, 0.0 recovery Œ∂, A , ‚Ñì ‚Ñì Œ∂ A function cashflow‚ÇÅ firm, Œµ, ‚Ñì div dividend firm, Œµ rec recovery firm, ‚Ñì cf div rec cf, div, rec end md\"\"\" II. Payment equilibrium \"\"\" md\"\"\" Banks' choice 1. payables receivables repay all debt solvent 2. not enough? liquidate part of the firm ``‚Ñì 0`` insolvent 3. still not enough? partially default on interbank debt bankrupt 4. still not enough? partially default on external liabilities ``ŒΩ`` \"\"\" md\"\"\" size of shock bind Œµ cash Slider 0.0 0.05 1.0, show value true, default 0.0 show illiquid firm value ``A`` bind show illiquid CheckBox default false recovery rate ``Œ∂`` bind recovery rate Slider 0 0.1 0.5, show value true, default 0.0 \"\"\" | aside md\"\"\" III. Financial Contagion default on interbank market ``\\implies`` lower interbank receivables for other banks ``\\implies`` reduces distance to default \"\"\" md\"\"\" | variable | value | | | | | ring vs complete ``Œ≥`` | bind Œ≥2 Slider 0 0.01 1, default 0.5, show value true | | dividend ``a`` | bind a Slider 0 0.01 1, default 0.7, show value true | | recovery rate ``Œ∂`` | bind Œ∂ Slider 0 0.01 1, default 0.3, show value true | | external | | | cash ``c`` | bind c Slider 0 0.1 2, default 1.2, show value true | | shock ``Œµ`` | bind Œµ Slider 0 0.1 2, default 0.0, show value true | | deposits ``ŒΩ`` | bind ŒΩ Slider 0.0 0.1 2, default 1.8, show value true | | internal | | | interbank ``y`` | bind y Slider 0 0.1 2, default 1.0, show value true | \"\"\" | aside md\"\"\" IV. Stability and Resilience \"\"\" md\"\"\" 1. More interbank lending leads to less stability and less resilience Formally, for a given regular financial network `` y ij `` let ``\\tilde y ij \\beta y ij `` for ``\\beta 1``. Financial network ``\\tilde y`` is less resilient and less stable see Proposition 3 . Proposition 3 More interbank lending leads to a more fragile system. For a given network topology, the defaults are increasing in ``\\bar y``. \"\"\" md\"\"\" 2. Densely connected networks are robust, yet fragile Our results thus confirm a conjecture of Andrew Haldane 2009, then Executive Director for Financial Stability at the Bank of England , who suggested that highly interconnected financial networks may be ‚Äúrobust yet fragile‚Äù in the sense that ‚Äúwithin a certain range, connections serve as shock absorbers and connectivity engenders robustness.‚Äù However, beyond that range, interconnections start to serve as a mechanism for the propagation of shocks, ‚Äúthe system flips to the wrong side of the knife edge,‚Äù and fragility prevails. Upto some ``\\varepsilon^ ``, the shock does not spread Above this value, all banks default This is an example for a phase transition it flips from being the most to the least stable and resilient network Compare Propositions 4 and 6 Proposition 4 For small shocks and big ``\\bar y``, the complete network ist the most resilitient and most stable financial network and the ring is the least resilient and least stable. Proposition 6 For big shocks, the ring and complete networks are the least resilient and least stable. \"\"\" A 0.5 md\"\"\" Assignment \"\"\" md\"\"\" Task 1 6 Points \"\"\" md\"\"\" üëâ 1.1 | 2 points Consider financial network ``\\tilde y``. What is the minimal number of shocks ``\\tilde p`` that have to occur to wipe out the whole financial system. Which banks have to be hit? How big would the shocks ``\\tilde \\varepsilon`` have to be? \"\"\" answer11 md\"\"\" Your answer goes here ... You can type math like this ``\\tilde p 17``, ``\\tilde \\varepsilon 1.1`` \"\"\" md\"\"\" üëâ 1.2 | 2 points Consider financial network ``\\hat y``. What is the minimal number of shocks ``\\hat p`` that have to occur to wipe out the whole financial system. Which banks have to be hit? How big would the shocks ``\\hat \\varepsilon`` have to be? \"\"\" answer12 md\"\"\" Your answer goes here ... You can type math like this ``\\hat p 17``, ``\\hat \\varepsilon 1.1`` \"\"\" md\"\"\" üëâ 1.3 | 2 points Now consider ``\\varepsilon \\max\\ \\tilde \\varepsilon, \\hat \\varepsilon \\ `` and ``p 1``. Which network is more stable? Which network is more resilient? \"\"\" answer13 md\"\"\" Your answer goes here ... You can type math like this ``\\hat p 17``, ``\\tilde \\varepsilon 1.1`` \"\"\" md\"\"\" Task 2 4 Points Consider the model of systemic risk by Acemoglu, Ozdaglar & Tahbaz Salehi 2015 with n 5 banks. There are two scenarios that differ by the structure of the financial network \\tilde y vs. \\hat y . Both \\tilde y and \\hat y are regular financial networks with parameter y . \"\"\" md\"\"\" Each bank owns a project that pays z i a \\varepsilon i in the intermediate period. \\varepsilon i 0 is a shock. Let \\tilde p be the minimal number of shocks, and \\tilde \\varepsilon be the minimal shock size that can wipe out the whole system that is, a simultaneous default of all banks under the financial network \\tilde y . \"\"\" md\"\"\" üëâ 2.1 | 2 points What is \\tilde p ? Explain which banks would have to be hit to wipe out the whole system. \"\"\" answer21 md\"\"\" Your answer goes here ... You can type math like this ``p 17``, ``\\varepsilon 1.1`` \"\"\" md\"\"\" üëâ 2.2 | 2 points Let \\delta 0 be very small and shock size \\varepsilon' \\in \\tilde \\varepsilon \\delta, \\tilde \\varepsilon . Conditional on p' 1 and \\varepsilon' , which network is more resilient and which network is more stable? Explain. \"\"\" answer22 md\"\"\" Your answer goes here ... You can type math like this ``p 17``, ``\\varepsilon 1.1`` \"\"\" md\"\"\" Before you submit ... üëâ Make sure you have added your names and your group number in the cells below. üëâ Make sure that that all group members proofread your submission especially your little essays . üëâ Go to the very top of the notebook and click on the symbol in the very top right corner. Export a static html file of this notebook for submission. The source code is embedded in the html file. \"\"\" group members firstname \"Ella Louise\", lastname \"Flores\" , firstname \"Padraig\", lastname \"Cope\" , firstname \"Christy\", lastname \"Denton\" group number 99 if group number 99 || group members 1 .firstname \"Ella Louise\" && group members 1 .lastname \"Flores\" md\"\"\" danger \"Note \" Before you submit , please replace the randomly generated names above by the names of your group and put the right group number in the appropriate cell. \"\"\" end md\"\"\" Task 3 not graded Avoiding a bank run \"\"\" md\"\"\" Consider the setup of Allen & Gale with banks ``i \\in \\ 1, 2, 3, 4\\ ``. Banks know that a fraction ``\\gamma`` of the population are early types . In the social optimum, banks offer deposit contracts `` c 1, c 2 ``. The fraction of early types ``\\omega i`` in each bank is random. There are three possible states ``S j \\omega 1j , \\omega 2j , \\omega 3j , \\omega 4j `` ```math \\begin align S 1 & \\gamma, \\gamma, \\gamma, \\gamma \\\\ S 2 & \\gamma \\varepsilon, \\gamma \\varepsilon, \\gamma \\varepsilon, \\gamma \\varepsilon \\\\ S 3 & \\gamma \\varepsilon, \\gamma \\varepsilon, \\gamma \\varepsilon, \\gamma \\varepsilon \\\\ \\end align ``` The states are shown in the figure below. The red dots mean \"more early customers\" ``\\gamma \\varepsilon`` , the green dots mean \"more late customers\" ``\\gamma \\varepsilon`` and the gray dots mean \"no shock\" ``\\gamma`` . \"\"\" states none, none, none, none , early, early, late, late , late, late, early, early , md\"\"\" Select state the ``i`` in ``S i`` bind i state NumberField 1 length states . \"\"\" md\"\"\" üëâ a What is the minimal number of edges that will prevent a bank run in period ``t 1`` in state ``S 1``? Explain briefly. \"\"\" answer a md\"\"\" Your answer goes here ... \"\"\" md\"\"\" üëâ b What is the minimal number of edges that will prevent a bank run in period ``t 1`` in all possible states? Explain and adjust the adjacency matrix `G minimal` accordingly. \"\"\" G minimal 0 1 1 1 0 0 1 1 1 0 0 1 1 1 0 0 answer b md\"\"\" Your answer goes here ... \"\"\" md\"\"\" üëâ c Assume that your minimal network from a has uniform weights . What is the lower bound ``y \\text min `` for that weight that will allow the socially optimal allocation in all states? \"\"\" answer c md\"\"\" Your answer goes here ... \"\"\" md\"\"\" üëâ d What will happen if ``y y \\text min ``? \"\"\" answer d md\"\"\" Your answer goes here ... \"\"\" md\"\"\" üëâ e Assume that there is a complete interbank network with a uniform weights to ensure the socially optimal allocation in all states. What would be an alternative state ``S 4`` in which the complete interbank network has a better outcome? \"\"\" answer e md\"\"\" Your answer goes here ... \"\"\" md\"\"\" Functions for Task 3 \"\"\" exX let S states i state n length S node styles title \"shock\", df DataFrame label string. early, late, none , color \"lightgreen\", \"tomato\", \"lightgray\" df chain begin DataFrame bank 1 n, label string. S leftjoin , node styles.df, on label end n, color df.color, node styles end function node legend figpos, node styles, title \"\" elems MarkerElement color, markersize 15, marker circle for color ‚àà node styles.color if length title 0 title tuple else title tuple title, end Legend figpos, elems, node styles.label, title tuple... orientation horizontal, titleposition left, framevisible false end md\"\"\" Appendix \"\"\" TableOfContents md\"\"\" Helpers \"\"\" md\"\"\" Packages \"\"\" md\"\"\" HTML Helpers \"\"\" htl \" style .blurry text color transparent text shadow 0 0 5px rgba 0,0,0,0.5 white space nowrap .blurry text hover color transparent text shadow 0 0 0px rgba 0,0,0.5 white space nowrap style \" blur text htl \"\"\" span class \"blurry text\" text span \"\"\" md\"\"\" ring vs complete `` Œ≥ `` bind Œ≥ Slider 0 0.1 1.0, show value true, default 0.5 shock to bank ``1`` `` Œµ `` bind Œµ Slider 0.0 0.05 1, show value true, default 0.0 blur \"number of islands \" bind n islands Slider 1 3, show value true, default 1 \"\"\" strike text htl \" s text s \" md\"\"\" Bank external debt deposits ``ŒΩ`` external assets cash ``c`` borrowing and lending on financial network see below investment in strike \"loan to\" firm see below Financial network ``n`` banks ``y ij 0 ‚ü∫`` bank ``i`` has debt with bank ``j`` the network is regular \\ ``\\forall i \\sum j y ij \\sum j y ji \\bar y`` \"\"\" vertical space space space htl \"\"\" p style \"line height space cm \" br p \"\"\" vertical space vertical space vertical space vertical space vertical space md\"\"\" Theorems, etc \"\"\" function theorem header type, number, title out type if isnothing number && length number 0 out out \" \" string number end if isnothing title && length title 0 out out \" \" string title end out end begin admonition kind, title, text Markdown.MD Markdown.Admonition kind, title, text proposition text number nothing, title nothing admonition \"correct\", theorem header \"Proposition\", number, title , text corollary text number nothing, title nothing admonition \"note\", theorem header \"Corollary\", number, title , text definition text number nothing, title nothing admonition \"warning\", theorem header \"Definition\", number, title , text assumption text number nothing, title nothing admonition \"danger\", theorem header \"Assumption\", number, title , text danger text, title \"Danger\" admonition \"danger\", title, text correct text, title \"Correct\" admonition \"hint\", title, text end Foldable \"Take away\", proposition md\"\"\" Small Shocks more complete ``\\implies`` fewer defaults Large shocks split up network ``\\implies`` fewer defaults Foldable \"in their words\", md\" Not all financial systems, however, are as fragile in the presence of large shocks. In fact, as part `` ii `` shows, for small enough values of ``Œ¥``, any ``Œ¥`` connected financial network is strictly more stable and resilient than both the complete and the ring networks. The presence of such weakly connected components in the network guarantees that the losses‚Äîrather than being transmitted to all other banks‚Äîare borne in part by the distressed bank‚Äôs senior creditors.\" \"\"\", title \"Acemoglu, Ozdaglar & Tahbaz Salehi 2015 \", md\"\"\" Packages \"\"\" md\"\"\" Line patterns in AlgebraOfGraphics \"\"\" hatch dict Dict Vec2f0 1 , \\ Vec2f0 1, 1 , Vec2f0 1, 0 , | Vec2f0 0, 1 , x Vec2f0 1 , Vec2f0 1, 1 , Vec2f0 1, 0 , Vec2f0 0, 1 hatches \\, , , |, x, line pattern hatch width 1.5, tilesize 10,10 , linecolor black, color white Makie.LinePattern direction hatch dict Symbol hatch , width, tilesize, linecolor, background color color md\"\"\" FinancialNetworks.jl \"\"\" md\"\"\" Payments and Equilibrium \"\"\" function repay c, ŒΩ , x, y , firm, Œµ assets ‚Ñì x c cashflow‚ÇÅ firm, Œµ, ‚Ñì .cf if ŒΩ y ‚â§ assets 0.0 out ‚Ñì 0, y pc 1.0, ŒΩ pc 1.0 elseif assets 0.0 ŒΩ y ‚â§ assets 1.0 ‚Ñì find zero ‚Ñì ŒΩ y assets ‚Ñì , 0.0, 1.0 out ‚Ñì, y pc 1.0, ŒΩ pc 1.0 else ‚Ñì 1.0 ass assets ‚Ñì if ŒΩ ‚â§ ass ŒΩ y out ‚Ñì, y pc ass ŒΩ y, ŒΩ pc 1.0 else assets ŒΩ out ‚Ñì, y pc 0.0, ŒΩ pc ass ŒΩ end end out..., assets assets out.‚Ñì , cashflow‚ÇÅ firm, Œµ, out.‚Ñì ..., firm pc 1 out.‚Ñì, x, y y out.y pc end md\"\"\" Visualize bank firm network \"\"\" function add legend figpos kwargs... dict lightgray \"solvent\", orange \"insolvent\", red \"bankrupt\" elements MarkerElement marker circle, strokewidth 1, markersize 20, color c for c in first. dict Legend figpos, elements, last. dict kwargs... figpos end md\"\"\" Visualize bank balance sheet \"\"\" function balance sheet palette palette df DataFrame label \"external\", \"interbank\", \"firm\", \"liquidated\", \"shortfall\" , color Makie.wong colors 5, 2, 4, 3, ..., Pattern \" \" palette df.label . palette df.color end function balance sheet df c, x, div, ill, rec, ŒΩ paid, y paid, shortfall receivable DataFrame color \"external\", val c, lab L\"cash c \" , color \"interbank\", val x, lab L\"IB deposit x \" , color \"firm\", val div, lab L\"dividend Œ¥ \" , color \"firm\", val ill, lab \"illiquid\" , color \"liquidated\", val rec, lab L\"recovered œÅ \" , payable DataFrame color \"external\", val ŒΩ paid, lab L\"deposits ŒΩ \" , color \"interbank\", val y paid, lab L\"IB debt y \" , color \"shortfall\", val shortfall, lab \"\" , nt receivable, payable vcat nt..., source side collect string. keys nt end function balance sheet df new bank, firm, x, y Œµ cash get bank, Œµ, 0.0 c‚ÇÄ bank.c c max c‚ÇÄ Œµ cash, 0.0 bank c, bank.ŒΩ y pc, ŒΩ pc, ‚Ñì, rec, div repay bank, x, y , firm, Œµ a, A firm ŒΩ, c bank y paid y pc y ŒΩ paid ŒΩ pc ŒΩ shortfall 1 ŒΩ pc ŒΩ 1 y pc y ill 1 ‚Ñì A df balance sheet df c, x, div, ill, rec, ŒΩ paid, y paid, shortfall bs max max A a x c‚ÇÄ, y ŒΩ df, bs max, ‚Ñì, shortfall end function visualize simple balance sheet bank, firm, x, y show illiquid true, fontsize 15 df, bs max, ‚Ñì, shortfall balance sheet df new bank, firm, x, y transform df, stack lab \"illiquid\" ? lab color if show illiquid || ‚Ñì ‚âà 1 subset df, lab ‚â† \"illiquid\" end if ‚Ñì firm.Œ∂ ‚âà 0 subset df, color ‚â† \"liquidated\" end subset df, val 0 transform df, subset val 0.3 , lab \"\" df.color categorical df.color ordered chain begin \"external\", \"interbank\", \"firm\", \"liquidated\", \"shortfall\" filter ‚àà unique df.color , end levels df.color, ordered df.stack categorical df.stack ordered chain begin \"external\", \"interbank\", \"firm\", \"liquidated\", \"illiquid\", \"shortfall\" filter ‚àà unique df.stack , end levels df.stack, ordered plt data df mapping side sorter \"receivable\", \"payable\" \"\", val \"\", stack stack, color color \"\", bar labels lab verbatim visual BarPlot, flip labels at 0, label size fontsize, strokewidth 0.5 plt, bs max end function visualize simple balance sheet args... figure , legend , kwargs... plt, bs max visualize simple balance sheet args... kwargs... if isempty legend legend position top, titleposition left, framevisible false end draw plt axis limits nothing, nothing, 0, 1.05 bs max , , figure, palettes color balance sheet palette , legend, end function visualize simple balance sheet figpos, legpos, args... legend , kwargs... plt, bs max visualize simple balance sheet args... kwargs... fg draw figpos, plt, palettes color balance sheet palette legend legpos, fg legend... end function balance sheet df ŒΩ, c , a, A, Œ∂ , ‚Ñì, y pc, ŒΩ pc, x, y, div, rec y paid y y y y pc ŒΩ paid ŒΩ pc ŒΩ shortfall 1 ŒΩ pc ŒΩ 1 y pc y ill 1 ‚Ñì A df balance sheet df c, x, div, ill, rec, ŒΩ paid, y paid, shortfall subset df, lab ‚â† \"illiquid\" bs max max a x c, y ŒΩ 1.05 df, bs max isfinite bs max ? bs max zero bs max end function visualize balance sheets figpos, bank df, banks, firm bank dfs balance sheet df banks i , firm, bank df i, for i ‚àà 1 length banks | StructArray combined bank df vcat bank dfs.df..., source bank transform combined bank df, bank \"bank bank \" bs max maximum bank dfs.bs max plt chain combined bank df begin data mapping side sorter \"receivable\", \"payable\" \"\", val \"\", color color \"\", stack color, layout bank visual BarPlot, strokewidth 0.5 end fg draw figpos 2,1 , plt, axis limits nothing, nothing, 0, 1.05 bs max , , palettes color balance sheet palette , legend figpos 1,1 , fg, orientation horizontal, titleposition left, framevisible false nothing end function visualize balance sheets out, banks, firms, shares fig Figure visualize balance sheets fig 1,1 , out, banks, firms, shares fig end md\"\"\" NetworkUtils.jl \"\"\" md\"\"\" Regular interbank market \"\"\" weighted adjacency matrix graph Graphs.weights graph . adjacency matrix graph . 0 function payments received promises, pc served Y weighted adjacency matrix promises vec pc served' Y end function payments promised promises Y weighted adjacency matrix promises dropdims sum Y, dims 2 , dims 2 end function iterate payments banks, promises, pc served, firm, Œµs firm, ‚Ñìs zeros length banks ys payments promised promises x new copy y out map enumerate banks do i, bank compute repayment xs payments received promises, pc served internal x xs i , y ys i rpy repay bank, internal, firm, Œµs firm i y pc, ‚Ñì rpy ‚Ñìs i ‚Ñì pc served i y pc return bank's choices bank i, rpy... end pc served, out, ‚Ñìs end function equilibrium banks, promises, firm, Œµ firms maxit 100 n banks length banks pc served ones n banks ‚Ñìs zeros n banks for it ‚àà 1 maxit ‚Ñìs old copy ‚Ñìs pc served old copy pc served pc served, out, ‚Ñìs iterate payments banks, promises, pc served, firm, Œµ firms, ‚Ñìs converged pc served old ‚âà pc served && ‚Ñìs old ‚âà ‚Ñìs if converged || it maxit bank df DataFrame out return bank df, it, success it maxit, banks end end end function is regular Y vec sum Y, dims 1 ‚âà vec sum Y, dims 2 end function is regular Y, yÃÑ is regular Y && mean sum Y, dims 1 ‚âà yÃÑ end initial network interbank market adjacency matrix interbank market.network updated network interbank market interbank market.payments function complete network n, »≥ Y fill »≥ n 1 , n, n for i in 1 n Y i,i 0.0 end Y end function CompleteNetwork n, »≥ SimpleWeightedDiGraph complete network n, »≥ end function ring network n, »≥ Y zeros n, n for i in 1 n 1 Y i, i 1 »≥ end Y n, 1 »≥ Y end function RingNetwork n, »≥ SimpleWeightedDiGraph ring network n, »≥ end function Œ≥ network n, »≥, Œ≥ Y Œ≥ ring network n, »≥ 1 Œ≥ complete network n, »≥ end function Œ≥Network n, »≥, Œ≥ SimpleWeightedDiGraph Œ≥ network n, »≥, Œ≥ end function island network n islands, n banks per island, »≥, Œ≥ blocks Œ≥ network n banks per island, »≥, Œ≥ for in 1 n islands cat blocks...,dims 1,2 end function island network n banks AbstractVector, »≥, Œ≥ blocks Œ≥ network n, »≥, Œ≥ for n ‚àà n banks cat blocks...,dims 1,2 end function IslandNetwork n islands, n banks per island, »≥ Œ≥ 0.0 Y island network n islands, n banks per island, »≥, Œ≥ SimpleWeightedDiGraph Y end function IslandNetwork n banks AbstractVector, »≥ Œ≥ 0.0 Y island network n banks, »≥, Œ≥ SimpleWeightedDiGraph Y end initial analysis let n banks 6 n firms n banks ŒΩ 2.3 c 2.4 banks ŒΩ, c max c i 1 Œµ , 0 for i ‚àà 1 n banks firm Œ∂ 0.0, a 0.0, A 0.5 Œµs zeros n banks yÃÑ 1.2 promises IslandNetwork n islands, n banks √∑ n islands, yÃÑ Œ≥ Œ≥ bank df equilibrium banks, promises, firm, Œµs promises, banks, firm, bank df end transmission analysis let n islands 1 n banks 4 banks ŒΩ, c max c i 1 Œµ, 0 for i ‚àà 1 n banks firm Œ∂, a, A Œµs zeros n banks yÃÑ y IM IslandNetwork n islands, n banks √∑ n islands, yÃÑ Œ≥ Œ≥2 bank df equilibrium banks, IM, firm, Œµs banks, firm, IM, bank df end md\"\"\" Layout \"\"\" begin function points on circle n c Point 0, 0 , r 1, start 0 if n 0 Point2 else x range 0, 2, n 1 . start . 0.5 x x begin end 1 Point2. r sinpi. x , r cospi. x . Ref c end end function nested circles inner r 1.5, start 0 function g n nodes nv g outer n nodes inner points on circle inner points on circle outer r, start end end function componentwise circle g AbstractGraph kwargs... components connected components g componentwise circle components kwargs... end function componentwise circle components scale 2.5 nodes Int node locs Point2f N length components ncol ceil Int, sqrt N for i, component in enumerate components row, col fldmod1 i, ncol n length component append nodes, component append node locs, points on circle n, c Point scale col 1 , scale 1 row end node locs sortperm nodes end end md\"\"\" NamedGraphPlot \"\"\" md\"\"\" Plotting helpers \"\"\" attr kwargs... arrow size 10, elabels distance 15, edge width 1, nlabels distance 10, kwargs... minimal extend limits 0.05, hidespines true, kwargs... xgridvisible false, xticksvisible false, xticklabelsvisible false, ygridvisible false, yticksvisible false, yticklabelsvisible false, leftspinevisible hidespines, rightspinevisible hidespines, topspinevisible hidespines, bottomspinevisible hidespines, xautolimitmargin extend limits, extend limits , yautolimitmargin extend limits, extend limits , kwargs... figure xscale 1, yscale xscale resolution xscale 300, yscale 300 md\"\"\" Named GraphPlot \"\"\" function text bbox textstring AbstractString, fontsize Union AbstractVector, Number , font, align, rotation, justification, lineheight glyph collection Makie.layout text textstring, fontsize, font, nothing, align, rotation, justification, lineheight, RGBAf 0,0,0,0 , RGBAf 0,0,0,0 , 0f0, 100 return Rect2f Makie.boundingbox glyph collection, Point3f 0 , Makie.to rotation rotation end md\"\"\" `LaTeXStrings` as `bar labels` \"\"\" function get xshift lb, ub, align default 0.5f0 if align isa Symbol align align left ? 0.0f0 align center ? 0.5f0 align right ? 1.0f0 default end lb 1 align ub align | Float32 end function get yshift lb, ub, align default 0.5f0 if align isa Symbol align align bottom ? 0.0f0 align center ? 0.5f0 align top ? 1.0f0 default end lb 1 align ub align | Float32 end begin fonts regular CairoMakie.Makie.MathTeXEngine.texfont , bold CairoMakie.Makie.MathTeXEngine.texfont set theme fonts using Makie automatic, compute x and width, barplot labels, bar rectangle, generate tex elements, TeXChar, FreeTypeAbstraction, GlyphExtent, height insensitive boundingbox with advance, origin, GlyphCollection, stack grouped from to, ATTRIBUTES, theme, bar label formatter function Makie.plot p BarPlot labels Observable Tuple Union String,LaTeXStrings.LaTeXString , Point2f label aligns Observable Vec2f label offsets Observable Vec2f label colors Observable RGBAf function calculate bars xy, fillto, offset, width, dodge, n dodge, gap, dodge gap, stack, dir, bar labels, flip labels at, label color, color over background, color over bar, label formatter, label offset in y direction get y true, x false , dir do error \"Invalid direction dir. Options are x and y.\" end x first. xy y last. xy by default, `width` is `minimum diff sort unique x ` if width automatic x unique unique filter isfinite, x x diffs diff sort x unique width isempty x diffs ? 1.0 minimum x diffs end compute width of bars and xÃÇ horizontal position after dodging xÃÇ, barwidth compute x and width x, width, gap, dodge, n dodge, dodge gap Stacking if stack automatic if fillto automatic fillto offset end elseif eltype stack Integer fillto automatic || warn \"Ignore keyword fillto when keyword stack is provided\" if iszero offset warn \"Ignore keyword offset when keyword stack is provided\" offset 0.0 end i stack stack from, to stack grouped from to i stack, y, x xÃÇ, y, fillto to, from else ArgumentError \"The keyword argument `stack` currently supports only `AbstractVector Integer `\" | throw end Labels if isnothing bar labels oback color over background automatic ? label color color over background obar color over bar automatic ? label color color over bar label args barplot labels xÃÇ, y, bar labels, in y direction, flip labels at, to color oback , to color obar , label formatter, label offset labels , label aligns , label offsets , label colors label args end return bar rectangle. xÃÇ, y . offset, barwidth, fillto, in y direction end bars lift calculate bars, p 1 , p.fillto, p.offset, p.width, p.dodge, p.n dodge, p.gap, p.dodge gap, p.stack, p.direction, p.bar labels, p.flip labels at, p.label color, p.color over background, p.color over bar, p.label formatter, p.label offset kwargs df DataFrame color p.color , colormap p.colormap , colorrange p.colorrange , strokewidth p.strokewidth , strokecolor p.strokecolor , visible p.visible , inspectable p.inspectable , transparency p.transparency , highclip p.highclip , lowclip p.lowclip , nan color p.nan color map zip bars , eachrow kwargs df do bar, kwargs poly p, bar kwargs... end if isnothing p.bar labels info p.label size text p, labels align label aligns, offset label offsets, color label colors, font p.label font, fontsize p.label size, rotation p.label rotation end end function Makie.texelems and glyph collection str LaTeXString, fontscale px, halign, valign, rotation, color, strokecolor, strokewidth, word wrap width rot convert attribute rotation, key\"rotation\" all els generate tex elements str els filter x x 1 isa TeXChar, all els hacky, but attr per char needs to be fixed fs Vec2f first fontscale px scales 2d Vec2f x 3 Vec2f fs for x in els texchars x 1 for x in els glyphindices FreeTypeAbstraction.glyph index texchar for texchar in texchars fonts texchar.font for texchar in texchars extents GlyphExtent. texchars bboxes map extents, scales 2d do ext, scale unscaled hi bb height insensitive boundingbox with advance ext return Rect2f origin unscaled hi bb scale, widths unscaled hi bb scale end basepositions to ndim Vec3f, fs, 0 . to ndim Point3f, x 2 , 0 for x in els if word wrap width 0 last space idx 0 last newline idx 1 newline offset Point3f basepositions 1 1 , 0f0, 0 for i in eachindex texchars basepositions i newline offset if texchars i .represented char ' ' || i length texchars right pos basepositions i 1 width bboxes i if last space idx 0 && right pos word wrap width section offset basepositions last space idx 1 1 lineheight maximum height bb for bb in bboxes last newline idx last space idx last newline idx last space idx 1 newline offset Point3f section offset, lineheight, 0 TODO newlines don't really need to represented at all? chars last space idx '\\n' for j in last space idx 1 i basepositions j Point3f section offset, lineheight, 0 end end last space idx i elseif texchars i .represented char '\\n' last space idx 0 end end end bb isempty bboxes ? BBox 0, 0, 0, 0 begin mapreduce union, zip bboxes, basepositions do b, pos Rect2f Rect3f b pos end end xshift get xshift minimum bb 1 , maximum bb 1 , halign yshift get yshift minimum bb 2 , maximum bb 2 , valign, default 0f0 shift Vec3f xshift, yshift, 0 positions basepositions . Ref shift positions . Ref rot . positions pre align gl GlyphCollection glyphindices, fonts, Point3f. positions , extents, scales 2d, rot, color, strokecolor, strokewidth all els, pre align gl, Point2f xshift, yshift end end balance sheet let c 0.7 ŒΩ 1.2 x 1.0 a 0.7 y 1.0 A 1.0 Œ∂ recovery rate shortfall max y ŒΩ c Œµ cash x a , 0 figure fonts, resolution 400, 350 , fontsize 15 firm a, A, Œ∂ visualize simple balance sheet c, ŒΩ, Œµ Œµ cash , firm, x, y figure, show illiquid | as svg end aside md\" balance sheet \" aside md\" balance sheet\" begin recipe NamedGraphPlot, graph do scene scatter theme default theme scene, Scatter lineseg theme default theme scene, LineSegments labels theme default theme scene, Makie.Text Attributes graphplot attr Attributes , node attributes Scatter node color lightgray, node strokewidth 0.5, node size automatic, node marker circle, node aspect regular, need for a better name node labels automatic, node font labels theme.fonts.regular, node fontsize labels theme.fontsize end function Makie.plot ngp NamedGraphPlot Extract attributes from plot object graph, graphplot attr, node color, node strokewidth, node size, node aspect, node marker, node labels, node font, node fontsize ngp Compute marker sizes out lift node labels, graph, node size, node fontsize, node font, node aspect do node labels, graph, node size, node fontsize, node font, node aspect if node labels automatic node labels string. 1 nv graph end Extract text sizes and layout accordingly label sizes widths text bbox string label , node fontsize, node font, center, center , 0f0, 0, 0 for label in node labels if regular use circle square, otherwise elipse rectangle if node aspect regular label sizes max pt... for pt in label sizes end We can specify markersize as a Vec2f, which is the eltype of label sizes. Thus, we can explicitly cause the node drawing to be large enough to accomodate the marker size. if node size automatic node size map x 1.7x . 0node fontsize, label sizes end node labels, label sizes, node size end lift node labels, label sizes, node size out node attr marker node marker, color node color, strokewidth node strokewidth, markersize node size, markerspace pixel, if hasproperty graphplot attr, node attr warn \"Ignoring node attr\" delete graphplot attr, node attr end gp graphplot ngp, graph graphplot attr..., node attr positions lift gp layout graph text ngp, positions text node labels, font node font, fontsize node fontsize, align center, center return ngp end end out T1 let y 2.1 yÃÉ IslandNetwork 3, 3, 5 , y yÃÇ IslandNetwork 6, 2, 1, 1, 1 , y assert nv yÃÉ nv yÃÇ n nv yÃÉ layout componentwise circle 1 6, 6 . 1 5 fig Figure figure 2.5, 1.0 ... ax1 Axis fig 1,1 minimal hidespines false, title L\"interbank market \\tilde y \" ... ax2 Axis fig 1,2 minimal hidespines false, title L\"interbank market \\hat y \" ... namedgraphplot ax1, yÃÉ, graphplot attr layout namedgraphplot ax2, yÃÇ, graphplot attr layout yÃÉ, yÃÇ, fig, n, y end out T1.fig | as svg markdown \"\"\" Consider the interbank networks ``\\\\tilde y`` and ``\\\\hat y`` of out T1.n banks as depicted above. For all non isolated banks the sum of interbank liabilities equal the sum of interbank claims ``y out T1.y `` . \"\"\" md\"\"\" For this exercise you can use the tool below, to simulate the payment equilibrium for a given interbank market, shock size, and the bank that is hit by the shock. Which bank is hit? ``i`` bind i T1 Slider 1 out T1.n, default 1, show value true Size of the shock ``\\varepsilon`` bind Œµ T1 Slider 0.0 0.1 3.0, show value true, default 1.0 Select ``\\tilde y`` or ``\\hat y`` bind IM T1 Select out T1.yÃÉ \"yÃÉ\", out T1.yÃÇ \"yÃÇ\" \"\"\" out T2 let yÃÑ 2.1 IM1 IslandNetwork 3, 2 , yÃÑ Œ≥ 0.0 IM2 IslandNetwork 3, 2 , yÃÑ Œ≥ 1.0 n1 nv IM1 n2 nv IM2 if n1 n2 n n1 else n n1, n2 end layout Shell fig Figure figure 2, 1 ... ax1 Axis fig 1,1 minimal hidespines false, title L\"interbank market \\tilde y \" ... ax2 Axis fig 1,2 minimal hidespines false, title L\"interbank market \\hat y \" ... namedgraphplot ax1, IM1 graphplot attr layout namedgraphplot ax2, IM2 graphplot attr layout IM1, IM2, fig, n | as svg end out T2.fig | as svg md\"\"\" If you have understood the mechanics of the model, you should be able to solve these tasks without simulations. You can use the given tool to verify your answer. Which bank is hit? ``i`` bind i bank T2 Slider 1 out T2.n, default 1, show value true Size of the shock ``\\varepsilon`` bind Œµ T2 Slider 0.0 0.1 3.0, show value true, default 1.0 Select ``\\tilde y`` or ``\\hat y`` bind IM T2 Select out T2.IM1 \"yÃÉ\", out T2.IM2 \"yÃÇ\" \"\"\" let g SimpleDiGraph G minimal fig, ax, namedgraphplot g node color exX.color, graphplot attr layout Shell , figure figure , axis minimal title latexstring \"interbank network in state \\ S i state \\ \" , extend limits 0.1 node styles exX if ismissing node styles title, df node styles node legend fig end 1,1 , df, title end fig | as svg end function visualize bank firm network ax, IM, bank df r 1.4, start Makie.automatic, layout Makie.automatic, show firms true, kwargs... A adjacency matrix IM n banks nv IM if show firms n firms n banks shares I n firms big A A shares' 0 shares 0 I else big A A end g big A | SimpleWeightedDiGraph n banks size A, 1 edge attr df map edges g do src, dst, weight if src ‚â§ n banks && dst ‚â§ n banks linewidth weight linestyle Makie.automatic arrow size 7 elseif dst n banks linewidth 0.5 arrow size 0.0 linestyle \" \" end linewidth, arrow size, linestyle end | DataFrame arrow attr markersize edge attr df.arrow size edge attr edge attr df.linewidth, edge attr df.linestyle node color ifelse. bank df.y pc . 1.0, red, ifelse. bank df.‚Ñì . 0.0, orange, lightgray nlabels string. 1 n banks node marker fill circle, n banks if show firms nlabels nlabels \"F i\" for i ‚àà 1 n firms node marker node marker fill rect, n firms node color node color fill colorant\"limegreen\", n firms end start start Makie.automatic ? 1 n banks start layout layout Makie.automatic ? nested circles n banks start, r layout graphplot attr layout, edge attr, arrow attr, edge plottype beziersegments, kwargs... namedgraphplot ax, g node labels nlabels, node marker, node color, graphplot attr nothing end let IM, firm, banks, bank df transmission analysis fig Figure resolution 800, 400 visualize bank firm network Axis fig 1,1 minimal extend limits 0.1 ... , IM, bank df start 1 8, show firms false visualize balance sheets fig 1,2 3 , bank df, banks, firm fig | as svg end function visualize bank firm network IM, bank df figure figure , add legend false, hidespines true, kwargs... fig Figure figure... ax Axis fig 1,1 minimal hidespines, extend limits 0.1 ... visualize bank firm network ax, IM, bank df kwargs... if add legend add legend fig 0, , orientation horizontal, framevisible false end fig | as svg end fig let promises, bank df initial analysis visualize bank firm network promises, bank df figure figure , start 1 6, show firms false end md\"\"\" 1. How do shocks propagate on a financial network? 2. How should a network look so that shocks don't spread? fig | aside figure \"\"\" md\"\"\" aside figure fig Plan for the lecture Goal Understand model and key results of Acemoglu, Ozdaglar & Tahbaz Salehi 2015 I. Model setup II. insolvency and bankruptcy in the payment equilibrium III. financial contagion IV. stability and resilience of financial networks more interbank lending leads to higher fragility densely connected networks are robust, yet fragile with big shocks , we want to have disconnected components V. Empirical relevance, Outlook \"\"\" firm bank aside let IM, firm, banks, bank df transmission analysis visualize bank firm network IM, bank df show firms false, start 1 8 | as svg | x md\" x \" | aside end let i i T1 IM IM T1 Œµ Œµ T1 n banks nv IM ŒΩ 3.0 c 0.0 Œ∂ 0.1 A 3.5 a 3.0 shares I n banks banks ŒΩ, c c for i ‚àà 1 n banks firm Œ∂, a, A Œµs zeros n banks Œµs i min Œµ, a bank df equilibrium banks, IM, firm, Œµs layout componentwise circle 1 6, 6 . 1 5 visualize bank firm network IM, bank df figure figure 1.25, 1.0 , hidespines false, start 1 6, layout, add legend true, show firms false | as svg end let i i bank T2 Œµ4 0.4 IM IM T2 n banks nv IM ŒΩ 3.0 c 0.0 Œ∂ 0.0 A 0.0 a 3.5 Œµ Œµ T2 shares I n banks banks ŒΩ, c for i ‚àà 1 n banks firm Œ∂, a, A Œµs zeros n banks Œµs i min Œµ, a bank df equilibrium banks, IM, firm, Œµs layout Shell visualize bank firm network IM, bank df figure figure 1.0, 1.0 , hidespines false, start 1 6, layout, add legend true, show firms false | aside figure end md\"\"\" Assignment infrastructure \"\"\" begin hint text Markdown.MD Markdown.Admonition \"hint\", \"Hint\", text almost text Markdown.MD Markdown.Admonition \"warning\", \"Almost there \", text still missing text md\"Replace `missing` with your answer.\" Markdown.MD Markdown.Admonition \"warning\", \"Here we go \", text keep working text md\"The answer is not quite right.\" Markdown.MD Markdown.Admonition \"danger\", \"Keep working on it \", text yays md\"Great \", md\"Yay ‚ù§\", md\"Great üéâ\", md\"Well done \", md\"Keep it up \", md\"Good job \", md\"Awesome \", md\"You got the right answer \", md\"Let's move on to the next section.\" correct text rand yays Markdown.MD Markdown.Admonition \"correct\", \"Got it \", text end members let names map group members do firstname, lastname firstname \" \" lastname end join names, \", \", \" & \" end md\"\"\" Assignment submitted by members group group number \"\"\" function wordcount text stripped text strip replace string text , r\"\\s\" \" \" words split stripped text, ' ', ' ', '.', ',', ' ', ' ', '\"', ' ', ' ', '\\'' length filter \"\" , words end test wordcount \" Hello, it's me. \" 4 test wordcount \"This doesn't really matter.\" 5 show words answer md\" approximately wordcount answer words \" show words answer a show words answer b show words answer c show words answer d show words answer e function show words limit answer, limit count wordcount answer if count 1.02 limit return show words answer else return almost md\"You are at count words. Please shorten your text a bit, to get below limit words .\" end end "},{"url":"julia-basics/basic-julia/","title":"Basic Julia","tags":["julia-basics"],"text":" A Pluto.jl notebook v0.19.22 frontmatter chapter 1 section 1 order 1 title \"Basic Julia\" layout \"layout.jlhtml\" description \"\" tags \"julia basics\" using Markdown using InteractiveUtils using PlutoUI md\"\"\" `basic julia.jl` | Version 1.2 | last updated Feb 3 2022 \"\"\" md\" A first glance at the Julia language This notebook briefly summarizes some of the basic Julia syntax that we will need for the problem sets. \" Markdown.MD Markdown.Admonition \"warning\", \"This notebook is taken from\", md\"\"\" Computational Thinking , a live online Julia Pluto textbook. computationalthinking.mit.edu https computationalthinking.mit.edu , original notebook https github.com mitmath 18S191 blob Fall20 lecture notebooks Basic%20Julia%20syntax.jl \"\"\" md\" Variables We can define a variable using ` ` assignment . Then we can use its value in other expressions \" x 3 y 2x md\"By default Julia displays the output of the last operation. You can suppress the output by adding ` ` a semicolon at the end. \" md\"We can ask what type a variable has using `typeof` \" typeof y md\" Functions\" md\"We can use a short form, one line function definition for simple functions \" f x 2 x md\"Typing the function's name gives information about the function. To call it we must use parentheses \" f f 10 md\"For longer functions we use the following syntax with the `function` keyword and `end` \" function g x, y z x y return z^2 end g 1, 2 md\" For loops\" md\"Use `for` to loop through a pre determined set of values \" let s 0 for i in 1 10 s s i end s end md\"Here, `1 10` is a range representing the numbers from 1 to 10 \" typeof 1 10 md\"Above we used a `let` block to define a new local variable `s`. But blocks of code like this are usually better inside functions, so that they can be reused. For example, we could rewrite the above as follows \" function mysum n s 0 for i in 1 n s s 1 end return s end mysum 100 md\" Conditionals `if`\" md\"We can evaluate whether a condition is true or not by simply writing the condition \" a 3 a 5 md\"We see that conditions have a Boolean `true` or `false` value. We can then use `if` to control what we do based on that value \" if a 5 \"small\" else \"big\" end md\"\"\"Note that the `if` also returns the last value that was evaluated, in this case the string `\"small\"` or `\"big\"`, Since Pluto is reactive, changing the definition of `a` above will automatically cause this to be reevaluated \"\"\" md\" Arrays\" md\" 1D arrays `Vector`s \" md\"We can make a `Vector` 1 dimensional, or 1D array using square brackets \" v 1, 2, 3 typeof v md\"The `1` in the type shows that this is a 1D array. We access elements also using square brackets \" v 2 v 2 10 md\"Note that Pluto does not automatically update cells when you modify elements of an array, but the value does change.\" md\"A nice way to create `Vector`s following a certain pattern is to use an array comprehension \" v2 i^2 for i in 1 10 md\" 2D arrays matrices \" md\"We can make small matrices 2D arrays with square brackets too \" M 1 2 3 4 typeof M md\"The `2` in the type confirms that this is a 2D array.\" md\"This won't work for larger matrices, though. For that we can use e.g.\" zeros 5, 5 md\"Note that `zeros` gives `Float64`s by default. We can also specify a type for the elements \" zeros Int, 4, 5 md\"We can then fill in the values we want by manipulating the elements, e.g. with a `for` loop.\" md\"A nice alternative syntax to create matrices following a certain pattern is an array comprehension with a double `for` loop \" i j for i in 1 5, j in 1 6 md\"\"\" Appendix \"\"\" TableOfContents "},{"url":"julia-basics/more-julia/","title":"More Julia","tags":["julia-basics"],"text":" A Pluto.jl notebook v0.19.22 frontmatter chapter 1 section 2 order 1 title \"More Julia\" layout \"layout.jlhtml\" description \"\" tags \"julia basics\" using Markdown using InteractiveUtils using DataFrames using DataFrameMacros using Chain chain using PlutoUI md\"\"\" `more julia.jl` | Version 1.1 | last updated May 10 2022 | created by Daniel Schmidt https github.com danieljschmidt \"\"\" md\"\"\" More Julia \"\"\" md\"\"\" The purpose of this notebook is to make you familiar with Julia syntax that is frequently used in the course material. It also points out the peculiarities of Pluto notebooks. \"\"\" md\"\"\" Named tuples and keyword arguments Named tuples Like many other programming languages, Julia allows you to create tuples. The elements of tuples can be accessed by using the corresponding index \"\"\" standard tuple 1, 2 standard tuple 1 md\"\"\" Julia also has named tuples. Just like standard tuples, named tuples allow you to access an element using its index, but alternatively you can also access an element by its name. \"\"\" named tuple a 1, b 2 named tuple.a md\"\"\" This is convenient because it means that you do not need to remember if some parameter is the first element in a tuple or the second one. Below you can see an alternative way of creating named tuples that is frequently used in the course material \"\"\" let a 1 named tuple2 a, b 2 a is equivalent to a a end md\"\"\" Keyword arguments A similar syntax with a semicolon is used for keyword arguments that are identified by name and not by their position as normal function arguments \"\"\" function some function a, b 1 return a b end some function a 3, b 5 let a 3 some function a, b 5 a is equivalent to a a end md\"\"\" Vectorization with dot syntax You can apply a function to all elements of a vector by using the dot syntax \"\"\" 1,2,3 .^ 2 log. 1,2,3 md\"\"\" Note how Julia usually does things in a way that's mathematically consistent. Look at the following code. \"\"\" A ones 3, 3 exp A exp. A A^2 A .^ 2 md\"\"\" What would Python, R or Matlab do? \"\"\" md\"\"\" The pipe operator The pipe operator | makes it possible to write down nested function calls in a more readable way. For example, the two expressions below do the same thing \"\"\" round log named tuple.b named tuple.b | log | round md\"\"\" In case you use R The | operator in Julia is similar to the % % operator in R. \"\"\" md\"\"\" Working with data Here are a few simple examples of working with DataFrames in Julia. If you are familiar with pandas, dplyr or Stata, have a look at this cheatsheet https dataframes.juliadata.org stable man comparisons . Also, have a look at the documentation of DataFrameMacros.jl https jkrumbiegel.github.io DataFrameMacros.jl stable which makes working with DataFrames much more convenient. \"\"\" md\"\"\" Creating a `DataFrame` \"\"\" df1 DataFrame x 1 10 md\"\"\" Transforming mutating a column \"\"\" transform df1, x ByRow x sqrt x transform df1, sqrt x uses transform from DataFrameMacros.jl md\"\"\" The ``` chain``` macro \"\"\" md\"\"\" The ``` chain``` macro works similar to the pipe operator. In the code for this course, the ``` chain``` macro is often applied to data frames together with macros from the ```DataFrameMacros``` package. \"\"\" df2 DataFrame A 1,2,2,1 , B randn 4 md\"\"\" Consider the data frame above. Let's say you would like to add up the values in the B column separately for each value of A take the absolute value of the resulting sums of B values. Using the ``` chain``` macro, we can perform this task with relatively concise code \"\"\" chain df2 begin groupby A combine sum B , automatically named C sum B specify name transform abs C end md\"\"\" Without the ``` chain``` macro, the code would look like this \"\"\" begin df groups groupby df2, A df sum combine df groups, sum B , C sum B transform df sum, abs C end md\"\"\" Unicode characters You can use Greek letters and other Unicode characters in your Julia code. For example, type \"\\alpha\" in the cell below without the quotation marks and press Tab on your keyboard. This should create an \\alpha symbol. \"\"\" md\"\"\" See the Julia documention https docs.julialang.org en v1 manual unicode input for a list of supported Unicode characters. For Greek letters, the abbreviations are the same as in LaTeX. \"\"\" md\"\"\" The \\in symbol An elegant way of writing loops is to use the \\in symbol instead of writing \"in\". The \\in symbol can be created by typing \"\\in\" and pressing Tab. \"\"\" i^2 for i ‚àà 1 5 md\"\"\" Pluto notebooks General advice Press F1 to see shortcuts for Pluto notebooks. Ctrl Click on an underlined variable or function to jump to its definition. Use the Live docs in the bottom right corner to get more information about any Julia function or object. Check the Github wiki https github.com fonsp Pluto.jl wiki for more information on Pluto notebooks. Automated updating of cells When changing a function or variable, Pluto automatically updates all affected cells. For example, change the value of d to some other number and see how the following cell updates automatically \"\"\" d 5 d 10 md\"\"\" This is different from jupyter notebooks in which you have to update related cells manually. The automated updating the advantage that you do not have to keep in mind the order in which to evaluate cells. However, it can also be annoying if some of the affected cells take a long time to run. At the time of writing, there is no way to turn off the automated updating but you can always manually disable cells with long run times by clicking on the three dots in the top right corner of a cell. \"\"\" md\"\"\" Only one expression per cell Pluto notebooks only allow one expression per cell. If you nevertheless want to place several expressions into the same cell, you have to use a begin ... end block \"\"\" begin e 10 f e 5 end md\"\"\" Cannot reuse variable names \"\"\" md\"\"\" Use `let` blocks to specify variable names locally. \"\"\" let g 3 end g md\"\"\" Deactivate cells \"\"\" ‚ï†‚ïê‚ï° sleep 5 ‚ï†‚ïê‚ï° md\"\"\" Imported Packages \"\"\" TableOfContents g 1 g 2 "},{"url":"networks-basics/coauthors/","title":"Co-authorship network","tags":["networks-basics"],"text":" A Pluto.jl notebook v0.19.36 frontmatter chapter 2 section 2 order 1 title \"Co authorship network\" layout \"layout.jlhtml\" tags \"networks basics\" description \"\" using Markdown using InteractiveUtils using Graphs using GraphDataFrameBridge using GraphMakie using CairoMakie using NetworkLayout using DataFrames using CSV CSV using PlutoUI TableOfContents, FilePicker md\"\"\" `view ti network.jl` | Version 1.3 | last updated Feb 7, 2022 \"\"\" md\"\"\" The Co Authorship Network of the Tinbergen Institute \"\"\" md\"\"\" We next analyze the network of co authorship relations between economists at the Tinbergen Institute. The next cells read the data collection of links between co authors and constructs the co author network from it. \"\"\" md\"\"\" Appendix \"\"\" md\"\"\" Download data \"\"\" url ti \"https greimel.github.io networks course assets datasets ti netwk0711.csv\" begin using DataDeps ENV \"DATADEPS ALWAYS ACCEPT\" true register DataDep \"TI network\", \"\"\" The co authorship network of the Tinbergen Institute 2007 2011. Made available with the permission of Marco van der Leij. \"\"\", url ti, \"dbb2a1d8ce1120ed274898ce76f84f7ef08f9938ad7f25f74d3b9f202dbc2137\" end edge df CSV.File joinpath datadep\"TI network\", \"ti netwk0711.csv\" | DataFrame g MetaGraph edge df, from, to graphplot g, layout Spring , edge color \"gray\", edge width 0.5, node size 10, node color \"orange\", node attr strokewidth 1, strokecolor black , list of components contains a list of nodes for each component components connected components g nodes in first largest component core components 1 ti plot graphplot g core , layout Spring , edge color \"gray\", edge width 0.5, node size 10, node color \"orange\", node attr strokewidth 0.5, strokecolor black , maximal subgraph with vertices of degree 3 or more g1 k core g, 3 graphplot g g1 , layout Spring , edge color gray, edge width 0.5, node size 10, node color orange, node attr strokewidth 0.5, strokecolor black core3 g g1 local clustering coefficient core3 degree centrality core3 eigenvector centrality core3 katz centrality core3, 0.3 md\"\"\" Packages \"\"\" md\"\"\" Graphs \"\"\" md\"\"\" Plotting \"\"\" md\"\"\" Data \"\"\" md\"\"\" Other \"\"\" TableOfContents "},{"url":"networks-basics/exercises-week1/","title":"Exercises","tags":["networks-basics"],"text":" A Pluto.jl notebook v0.19.36 frontmatter chapter 2 section 5 order 1 title \"Exercises\" layout \"layout.jlhtml\" tags \"networks basics\" description \"\" using Markdown using InteractiveUtils using MetaGraphs using Graphs using GraphDataFrameBridge using AlgebraOfGraphics using CairoMakie using GraphMakie using NetworkLayout using DataFrames using CSV CSV using DataFrameMacros, Chain using PlutoUI using Statistics mean, std using StatsBase md\"\"\" `exercises week 1.jl` | Version 1.2 | last updated Feb 3, 2023 \"\"\" md\"\"\" Exercises for week 1 \"\"\" md\"\"\" Part 1 Theory exercises The first few exercises will deal with the following simple graph. \"\"\" md\" Exercise 1 üëâ Calculate by hand the betweenness centrality of node 5 in the simple network above. \" md\"\"\" Your answer goes here ... \"\"\" md\"\"\" Check your answer by activating the cell below. \"\"\" ‚ï†‚ïê‚ï° betweenness centrality simple graph 5 ‚ï†‚ïê‚ï° md\" Exercise 2 Below you can calculate the eigenvector centrality and Katz Bonacich centrality ``\\alpha 0.2`` and exogenous factors ``e i 1`` for all nodes ``i``. üëâ First, guess which nodes have the highest eigenvector centrality. \" md\"\"\" Your guess goes here ... \"\"\" md\"\"\" üëâ Now check your guess with the following code. \"\"\" ‚ï†‚ïê‚ï° eigenvector centrality simple graph ‚ï†‚ïê‚ï° ‚ï†‚ïê‚ï° katz centrality simple graph, 0.2 ‚ï†‚ïê‚ï° ‚ï†‚ïê‚ï° betweenness centrality simple graph ‚ï†‚ïê‚ï° md\" Note that the betweenness centrality picks out nodes 5 and 6 as being most central, which corresponds to our intuition. The eigenvector centrality and Katz Bonacich centrality fail to identify these nodes as being central. We try to obtain some insight into this by making a calculation for the Katz Bonacich centrality. Exercise 3 üëâ Write out the series representing the Katz Bonacich centrality for general 0 \\alpha \\lambda \\rm max . Explain why all nodes have the same Katz Bonacich centrality in this case. \" md\"\"\" Your answer goes here ... \"\"\" md\"\"\" Part 2 Computational exercises The next set of exercises will analyze the co authorship network of the Tinbergen Institute that you've seen already. \"\"\" md\"\"\" Exercise 4 Connected components üëâ Identify the components of this network and extract the core. \"\"\" md\"\"\" Exercise 5 Central researchers Let us now find the most central researchers of the Tinbergen institute. \"\"\" md\" üëâ Calculate the top 10 centralities for the largest component in this co authorship network in terms of degree, betweenness, eigenvector centrality and Katz Bonancich centrality with ``\\alpha 0.2`` \" md\"\"\" Exercise 6 Comparing centrality measures üëâ Compare the ranks for different centrality measures. \"\"\" md\" Again we see that the ranking of the nodes in terms of the centrality depends strongly on the measure of centrality used. \" md\"\"\" Appendix \"\"\" md\"\"\" Construct simple network \"\"\" A 1 2 1 3 1 4 2 3 2 4 3 5 4 5 5 6 6 7 6 8 7 9 7 10 8 9 8 10 9 10 df DataFrame A, auto simple graph MetaGraph df, x1, x2 let fig, ax, plt graphplot simple graph, layout Spring , ilabels vertices simple graph , edge color \"gray\", edge width 0.5, node color \"orange\", hidedecorations ax fig end graphplot simple graph md\"\"\" Load TI data \"\"\" node names metagraph getindex. Ref metagraph , 1 nv metagraph , name url ti \"https greimel.github.io networks course assets datasets ti netwk0711.csv\" begin using DataDeps ENV \"DATADEPS ALWAYS ACCEPT\" true register DataDep \"TI network\", \"\"\" The co authorship network of the Tinbergen Institute 2007 2011. Made available with the permission of Marco van der Leij. \"\"\", url ti, \"dbb2a1d8ce1120ed274898ce76f84f7ef08f9938ad7f25f74d3b9f202dbc2137\" end begin edge list CSV.File joinpath datadep\"TI network\", \"ti netwk0711.csv\" edge df DataFrame edge list end ti graph MetaGraph edge df, from, to graphplot ti graph, layout Spring , edge color \"gray\", edge width 0.5, node size 10, node color \"orange\", nlabels node names ti graph , node attr strokewidth 1, strokecolor black , list of components contains a list of nodes for each component components connected components ti graph nodes in first largest component core components 1 gc ti graph core ti plot graphplot gc, layout Spring , edge color \"gray\", edge width 0.5, node size 10, node color \"orange\", node attr strokewidth 1, strokecolor black , competerank eigenvector centrality ti graph researchers df let df DataFrame name node names ti graph , index 1 nv ti graph sort df, index end central researchers chain researchers df begin transform eigenvector centrality bycol eigenvector centrality ti graph , degree centrality bycol degree centrality ti graph , bonacich katz centrality bycol katz centrality ti graph, 0.2 , transform rank eigenvector bycol competerank eigenvector centrality, rev true , rank degree bycol competerank degree centrality, rev true , rank bonacich katz bycol competerank bonacich katz centrality, rev true select name, r\"rank\", r\"centrality\", end sort central researchers, rank degree graphplot ti graph, layout Spring , edge color \"gray\", edge width 0.5, node size 10, nlabels ifelse. central researchers.rank degree .‚â§ 10, if this condition holds central researchers.name, then provide name as label \"\" else provide no label \"\" , node color ifelse. central researchers.rank degree .‚â§ 10, orange, gray , node attr strokewidth 1, strokecolor black , data central researchers mapping rank bonacich katz, rank eigenvector, visual Scatter | draw md\"\"\" Packages \"\"\" md\"\"\" Graphs \"\"\" md\"\"\" Plotting \"\"\" md\"\"\" Data \"\"\" md\"\"\" Other \"\"\" TableOfContents "},{"url":"networks-basics/first-networks/","title":"First networks","tags":["networks-basics"],"text":" A Pluto.jl notebook v0.19.36 frontmatter chapter 2 section 1 order 1 title \"First networks\" layout \"layout.jlhtml\" tags \"networks basics\" description \"\" using Markdown using InteractiveUtils This Pluto notebook uses bind for interactivity. When running this notebook outside of Pluto, the following 'mock version' of bind gives bound variables a default value instead of an error . macro bind def, element quote local iv try Base.loaded modules Base.PkgId Base.UUID \"6e696c72 6542 2067 7265 42206c756150\" , \"AbstractPlutoDingetjes\" .Bonds.initial value catch b missing end local el esc element global esc def Core.applicable Base.get, el ? Base.get el iv el el end end using Colors colorant str using Graphs for analyzing networks using SimpleWeightedGraphs for handling weighted graphs using MetaGraphs using SNAPDatasets cool datasets of big networks using GraphMakie for plotting networks using NetworkLayout layout algorithms using CairoMakie hist using Statistics mean, std using FreqTables using StatsBase ecdf using PlutoUI TableOfContents, Slider using PlutoUI md\"\"\" `first networks.jl` | Version 1.5 | last updated Feb 6 2023 \"\"\" md\"\"\" First networks in Julia In this section we show you how to create networks in Julia and how to visualize them. 1. special named graphs 2. do it yourself 3. from a dataset \"\"\" md\"\"\" Networks with names Let us plot our first networks. Below you see star network can you imagine why it is called that way? . You can specify it by \"\"\" n nodes 10 simple network StarGraph n nodes graphplot simple network, node size 20, node color \"orange\" md\" Play around with this code. You can change the number of nodes and see you the plot will update automatically. You can also look at different special graphs wheel network `WheelGraph` circle network `CycleGraph` complete network `CompleteGraph` path network `PathGraph` Try it and visualize a few graphs \" begin my network SimpleDiGraph 7 add edge my network, 3, 4 add edge my network, 2, 3 end md\"\"\" Building a network from scratch Below you find a template of building a network from scratch. Play with it make it your own you can set the number of nodes currently nv my network and add a few edges there are currently ne my network . Can you rebuild one of the named networks from above? \"\"\" md\"\"\" Note, that you can build directed graphs using `SimpleDiGraph`. Replace `SimpleDiGraph` by `SimpleGraph` to get an undirected graph. \"\"\" graphplot my network, layout Shell , arrow size 20, node color \"orange\", ilabels vertices my network md\"\"\" Building networks from real world data There are plenty of network datasets out there. You can check out the Stanford Large Network Dataset Collection link https snap.stanford.edu data index.html . A very small subset of these datasets can be downloaded directly from Julia using the package SNAPDatasets.jl link https github.com JuliaGraphs SNAPDatasets.jl . Let us have a look at the Facebook dataset, with 4039 nodes and 88234 edges. link to description https snap.stanford.edu data ego Facebook.html \"\"\" big network loadsnap facebook combined md\"Even though the dataset is rather small compared to others from this collection, we already run into problems when we want to visualize the network. The time it takes to plot a big network is mainly driven by the layout algorithm. That's why I choose the boring Shell algorithm, where all nodes are placed on a circle. This is very fast. If you want, you can try to plot this with the default layout algorithm. On my recent MacBook Pro, this took more than two minutes then I interrupted the execution of the cell. \" graphplot big network, layout Shell , layout SquareGrid , node size 2, edge width 1, node color blue, edge color orange, 0.01 md\"\"\" Language for network analysis We will discuss some useful concepts for analyzing networks. We will divide them into four groups. NOTE The concepts of this section are introduced in the first lectures of the course. Have a look if you're curious. But it is rather meant as a references for your assignments. If you cannot find what you need in this notebook, check out the excellent documentation of Graphs.jl https juliagraphs.org Graphs.jl dev . Counting friends neighborhood degree in out degree distribution, average degree Are my friends friends themselves? clustering average, total Friends of friends of friends ... walk path connected pair distance diameter connected network components Cool kids centralities \"\"\" network big network ‚à™ k neighbors big network, k for k ‚àà 5, 50, 101, 500 ... nodes rand 1 nv big network , 10 | unique md\"\"\" Neighborhood and degree of a node Counting friends The neighborhood of a node ``i`` is the set of friends of nodes that are connected to ``i``. Let ``i `` bind i Slider 1 nv network , default 1, show value true , then the neighborhood of ``i`` is shown below. The degree of a node ``i`` is number of friends connected nodes of ``i``. Show degree bind show degree CheckBox default false \"\"\" md\"\"\" The degree distribution is the distribution of the number of friends. We can compute statistics of the distribution e.g. the average degree round mean degree network , digits 2 . Or we can visualize the full distribution in a histogram. \"\"\" hist degree network , bins 1 25, normalization probability, axis title \"The degree distribution The distribution of the number of friends \", ylabel \"relative frequency\", xlabel \"degree number of friends \" md\"\"\" Clustering Are my friends friends themselves? This time we look at node ``j `` bind j Slider 1 nv network , default 12, show value true . \"\"\" degree of j degree network, j actual links, possible links local clustering network, j md\"\"\" We see that the node has degree of j friends. These degree of j friends can form at most degree of j ‚ãÖ degree of j 1 2 possible links friendships. We see that there are actual links friendships red edges . The clustering coefficient of node i is ``\\frac \\text actual \\text possible `` round local clustering coefficient network, j , digits 2 . Show clustering coefficient bind show clustering CheckBox default false \"\"\" local clustering coefficient network, j global clustering coefficient network ùí© neighbors network, j md\"\"\" Distance between nodes Friends of friends of friends ... \"\"\" md\"\"\" walk path connected pair distance diameter connected network components \"\"\" from 13 to 23 path a star network, from, to length path function color nodes graph, sets of nodes default color colorant\"lightgray\" colors Makie.wong colors 1 length sets of nodes default color extended sets sets of nodes..., 1 nv graph groups map 1 nv graph do i findfirst set i ‚àà set, extended sets end colors groups end graphplot network, node size 19, edge width 1, ilabels vertices network , node color color nodes network, from, to , edge color e ‚àà path || reverse e ‚àà path ? red gray for e ‚àà edges network function highlight neighbors graph, i color nodes graph, i , neighbors graph, i end graphplot network, edge width 1, ilabels vertices network , node size 20, nlabels show degree ? nothing \"deg \" . string. degree network , nlabels offset Point2f 0.1, 0.0 , node color highlight neighbors network, i , edge color black, 0.5 graphplot network, node size 19, edge width 1, ilabels vertices network , nlabels show clustering ? nothing \"cl \" . string. round. local clustering coefficient network , digits 2 , string. 1 nv network . \" clust. \" . string. round. local clustering coefficient network , digits 2 . \" \", node color highlight neighbors network, j , edge color src e ‚àà ùí© && dst e ‚àà ùí© ? red gray for e ‚àà edges network md\"\"\" Components, path length and diameter \"\"\" components connected components network subnetwork network components 1 diameter subnetwork diameter network md\"\"\" To get the length of shortest path from node `i` to node `j` use `gdistances graph, i j `. \"\"\" distances from 1 gdistances network, 1 dist from 1 to 5 distances from 1 5 function giant component graph components connected components graph compute the size of nodes of each component size of components length. components find the component with maximal number of nodes n nodes, ind findmax size of components return the giant component giant component components ind end giant component my network subgraph, node list induced subgraph network, giant component network graphplot subgraph, node size 20, arrow size 20, node color \"orange\" let f x log 1 ecdf degree network x x vec exp. 0 0.01 6 lines x vec, f. x vec end diameter big network is connected big network Todo check if this needs to be transposed function distance matrix graph n nv graph number of vertices distance matrix zeros Int, n, n for i, node in enumerate vertices graph distance matrix i, . gdistances graph, node end distance matrix end distance matrix simple network md\" Centralities \" katz centrality big network katz centrality big network, 0.3 betweenness centrality simple network eigenvector centrality simple network closeness centrality simple network md\"\"\" Weighted graphs You can work with weighted networks using the package `SimpleWeightedGraphs`. It offers the types `SimpleWeightedGraph` and `SimpleWeightedDiGraph`. Let's construct a weighted directed network. \"\"\" begin weighted network SimpleWeightedDiGraph 3 add edge weighted network, 1, 2, 0.5 add edge weighted network, 2, 3, 0.8 add edge weighted network, 1, 3, 2.0 end adjacency matrix weighted network edge weights e.weight for e in edges weighted network graphplot weighted network, elabels string. edge weights , ilabels vertices weighted network indegree weighted network outdegree weighted network degree weighted network md\"\"\" Issue with weighted graphs advanced There is a second way of constructing weighted graphs. \"\"\" begin meta graph MetaDiGraph 3 add edge meta graph, 1, 2 add edge meta graph, 2, 3 add edge meta graph, 1, 3 set prop meta graph, 1, 2, weight, 0.5 set prop meta graph, 2, 3, weight, 0.8 set prop meta graph, 1, 3, weight, 2.0 meta graph end md\"\"\" `MetaGraph`s are convenient to work with because they can store names of nodes and other meta data. However, they behave slightly differently than `SimpleWeightedGraphs`. The `adjacency matrix` is a matrix of 0 and 1 not showing the weights . \"\"\" adjacency matrix meta graph . weights meta graph md\"\"\" In order to get the matrix representation of the weighted graph use \"\"\" md\"\"\" This inconsistency will likely be fixed in the future. See this issue on github https github.com JuliaGraphs LightGraphs.jl issues 1519 . \"\"\" md\"\"\" Appendix \"\"\" TableOfContents md\"\"\" Packages \"\"\" md\"\"\" Graphs \"\"\" md\"\"\" Plotting \"\"\" md\"\"\" Statistics \"\"\" md\"\"\" Other \"\"\" "},{"url":"networks-basics/random-networks/","title":"Random networks","tags":["networks-basics"],"text":" A Pluto.jl notebook v0.19.22 frontmatter chapter 2 section 4 order 1 title \"Random networks\" layout \"layout.jlhtml\" tags \"networks basics\" description \"\" using Markdown using InteractiveUtils using PlutoUI using Graphs using GraphMakie using CairoMakie using GraphDataFrameBridge using NetworkLayout using DataFrames using CSV, HTTP using Statistics, StatsBase md\"\"\" `random networks.jl` | Version 1.1 | last updated Feb 2, 2023 \"\"\" md\"\"\" Comparing random networks with the TI co authorship network \"\"\" md\" Giant component of Erdos Renyi random networks \" g1 erdos renyi 1000, 1 1200 g2 erdos renyi 1000, 1 800 components1 sort connected components g1 , by size, rev true components2 sort connected components g2 , by size, rev true gc1 g1 components1 1 gc2 g2 components2 1 md\" Tinbergen Institute coauthorship network \" md\" Erdos Renyi random network \" md\" Find n and p \" md\" Watts Strogatz random network Small World Model \" md\" Barabasi Albert network preferential attachment \" md\" Jackson Rogers network \" md\" To be implemented ... \" md\" Create TI network from list of edges \" function csv from url url CSV.File HTTP.get url .body end md\"\"\" Appendix \"\"\" TableOfContents md\"\"\" Download data \"\"\" url ti \"https greimel.github.io networks course assets datasets ti netwk0711.csv\" begin using DataDeps ENV \"DATADEPS ALWAYS ACCEPT\" true register DataDep \"TI network\", \"\"\" The co authorship network of the Tinbergen Institute 2007 2011. Made available with the permission of Marco van der Leij. \"\"\", url ti, \"dbb2a1d8ce1120ed274898ce76f84f7ef08f9938ad7f25f74d3b9f202dbc2137\" end edge df CSV.File joinpath datadep\"TI network\", \"ti netwk0711.csv\" | DataFrame g ti MetaGraph links list, from, to g ti MetaGraph edge df, from, to ti plot graphplot g ti, layout Spring , edge color \"gray\", edge width 0.5, node size 10, node color \"orange\", node attr strokewidth 1, strokecolor black , g ti mean degree g ti global clustering coefficient g ti hist degree g ti maximum degree g ti n size g ti 1 g ws watts strogatz n, 4, 0.1 graphplot g ws, layout Spring , edge color \"gray\", edge width 0.5, node size 10, node color \"orange\", node attr strokewidth 1, strokecolor black , mean degree g ws global clustering coefficient g ws maximum degree g ws hist degree g ws components ws sort connected components g ws , by size, rev true core ws g ws components ws 1 core ws diameter core ws g ba barabasi albert n,2 graphplot g ba, layout Spring , edge color \"gray\", edge width 0.5, node size 10, node color \"orange\", node attr strokewidth 1, strokecolor black , mean degree g ba 2.4 for TI network global clustering coefficient g ba 0.31 for TI network maximum degree g ba 9 for TI network hist degree g ba components ba sort connected components g ba , by size, rev true core ba g ba components ba 1 core ba 61, 88 for TI network diameter core ba p mean degree g ti n 1 check p 139 115 114 2 g er erdos renyi n, p graphplot g er, layout Spring , edge color \"gray\", edge width 0.5, node size 10, node color \"orange\", node attr strokewidth 1, strokecolor black , mean degree g er , std degree g ti global clustering coefficient g er , std local clustering coefficient g ti maximum degree g er hist degree g er components er sort connected components g er , by size, rev true core er g er components er 1 core er diameter core er list of components contains a list of nodes for each component components ti sort connected components g ti , by size, rev true nodes in first largest component core ti g ti components ti 1 core ti diameter core ti md\"\"\" Packages \"\"\" "},{"url":"networks-basics/stylized-facts/","title":"Typical properties of social networks","tags":["networks-basics"],"text":" A Pluto.jl notebook v0.19.22 frontmatter chapter 2 section 3 order 1 title \"Typical properties of social networks\" layout \"layout.jlhtml\" description \"\" tags \"networks basics\" using Markdown using InteractiveUtils using Graphs using SimpleWeightedGraphs using GraphMakie graphplot using CairoMakie hist, lines, scatter using NetworkLayout layout algorithms using SNAPDatasets loadsnap cool datasets of big networks using PlutoUI TableOfContents using Statistics mean, std using FreqTables freqtable using StatsBase ecdf md\"\"\" `stylized facts.jl` | Version 1.0 | last updated Feb 2, 2023 \"\"\" md\"\"\" Typical properties of social networks \"\"\" md\" 1. Low average degree ``\\bar d \\ll n`` Let us first compute the degree for each node. \" md\"\"\" Then we can compute the mean degree and compare it to the number of nodes. \"\"\" md\"\"\" We can have a look at the full degree distribution by plotting a histogram. \"\"\" md\" 2. High clustering Cl \\gg 1 n \" md\"\"\" 3. There is a giant component \"\"\" md\" 4. Short average distance \" md\"\"\" 5. The degree distribution follows a Power law \"\"\" md\" in large k tail \" md\"\"\" Building networks from real world data There are plenty of network datasets out there. You can check out the Stanford Large Network Dataset Collection link https snap.stanford.edu data index.html . A very small subset of these datasets can be downloaded directly from Julia using the package SNAPDatasets.jl link https github.com JuliaGraphs SNAPDatasets.jl . Let us have a look at the Facebook dataset, with 4039 nodes and 88234 edges. link to description https snap.stanford.edu data ego Facebook.html \"\"\" big network loadsnap facebook combined big network loadsnap ego twitter u big network loadsnap soc slashdot0902 u degrees degree big network md\"\"\" Indeed, the mean degree round mean degrees , digits 2 is much lower then the number of nodes. \"\"\" std degrees hist degrees let f x log 1 ecdf degrees x x vec exp. range 0, 6, length 200 x vec range 1, 400, length 200 lines x vec, f. x vec end mean degrees , nv big network nv number of vertices global clustering coefficient big network , 1 size big network 1 is connected big network diameter big network md\"Even though the dataset is rather small compared to others from this collection, we already run into problems when we want to visualize the network. The time it takes to plot a big network is mainly driven by the layout algorithm. That's why I choose the boring Shell algorithm, where all nodes are placed on a circle. This is very fast. If you want, you can try to plot this with the default layout algorithm. On my recent MacBook Pro, this took more than two minutes then I interrupted the execution of the cell. \" graphplot big network, layout Shell , node size 2, edge width 1, node color blue, edge color orange, 0.01 md\"\"\" Components, path length and diameter \"\"\" md\"\"\" To get the length of shortest path from node `i` to node `j` use `gdistances graph, i j `. \"\"\" function giant component graph components connected components graph compute the size of nodes of each component size of components length. components find the component with maximal number of nodes n nodes, ind findmax size of components return the giant component giant component components ind end size giant component big network , nv big network md\"\"\" Appendix \"\"\" TableOfContents md\"\"\" Packages \"\"\" md\"\"\" Graphs \"\"\" md\"\"\" Plotting \"\"\" md\"\"\" Other \"\"\" md\"\"\" Basic statistics \"\"\" "}]